<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <!--<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M8WBXH7');</script>-->
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href=/public/stylesheets/bs.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/styles.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/pygment_trac.css?random=@Environment.TickCount>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="canonical" href="made2591.github.io/posts/textual-game">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <link rel="icon" type="image/x-icon"  href="/favicon.ico" />
    <title>My first textual game | Matteo Madeddu</title>
    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <!--<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8WBXH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrapper">
        <section>
          <div id="header">
  <h1>
    <a id="sitename" href="">Matteo Madeddu</a>
  </h1>

  <!-- Add something about you in p tag-->
  <p>Mac OS lover, Docker fan, Go explorer, Python geek, Trello addicted.</p>
  <hr/>

  <span class="credits pull-left">
    
      <a href="/">Home</a>  | 
    
      <a href="/blog">Blog</a>  | 
    
      <a href="/archive">Archive</a>  | 
    
      <a href="/about">About</a>  | 
    
      <a href="/matteo_madeddu_cv.pdf">Resume</a>  | 
    
      <a href="/quotes">Quotes</a> 
    
  </span>

  <span class="credits pull-right social">
    
      
        <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
      
    
      
        <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
      
    
      
        <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
      
    
      
        <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
      
    
  </span>


</div>


          <div class="post-title">
    <h1>My first textual game</h1>
    <p class="text-muted">
    


    02 Jan 2018
    
     | <i class="fa fa-comment"></i> <a class="text-muted" href="/posts/textual-game/#disqus_thread"></a>
    

    
      | <i class="fa fa-tag"></i>
      
        <a class="text-muted" href="/tags/#coding ">coding</a>,
      
        <a class="text-muted" href="/tags/#vintage ">vintage</a>,
      
        <a class="text-muted" href="/tags/#eighties ">eighties</a>,
      
        <a class="text-muted" href="/tags/#game ">game</a>,
      
        <a class="text-muted" href="/tags/#golang ">golang</a>
      
    
  </p>
</div>

  <h3 id="a-beautiful-childhood">A beautiful childhood</h3>
<p>I’ve never been a fan of videogames, neither as a child nor today: do not get me wrong, as many guys of my generation I also owned and played with the legendary <strong>PlayStation 1</strong> (1995)<sup id="fnref:p1"><a href="#fn:p1" class="footnote">1</a></sup> and <strong>PlayStation 2</strong><sup id="fnref:p2"><a href="#fn:p2" class="footnote">2</a></sup> by Sony and the <strong>Nintendo Game Boy</strong><sup id="fnref:gb"><a href="#fn:gb" class="footnote">3</a></sup>. It was fun, but not so much as playing to videogames born a few years before I was born. 
In the 80s, there were not yet the powerful graphics chips that today can be found with a few hundred euros. How did the videogames work? It’s simple: without graphics. There were many <em>textual games</em> and in my opinion, for many vintage lovers, they would still be cool today. My generation has lost this advantage of literaly <em>building with fantasy the world around a game</em>. So, some days ago I found my self thinking back to Sheldoon Cooper that plays with the game Dungeon in the Big Bang Theory<sup id="fnref:bbt"><a href="#fn:bbt" class="footnote">4</a></sup>, or to the kids of <em>Stranger Things</em> by Netflix, or to my father, to whom I gave an original <em>Playstation 1</em> with the first TombRaider(s), and I asked myself <em>how it would be possible today to play again one of those text games</em> that were so popular in that decade…to the point of deciding to create one of my own.</p>

<p align="center"><img src="https://res.cloudinary.com/lmn/image/upload/e_sharpen:100/f_auto,fl_lossy,q_auto/v1/gameskinnyc/c/o/l/colossalcaveadventure1-100023877-orig-99278.jpg" style="width: 100%; marker-top: -10px;" /></p>

<p>In this article I will talk about how to create a vintage 80s game! If you want to download the a technical preview of textual Tomb Raider right now, <a href="http://github.com/made2591/tomb-raider">here</a> is the source code. If you want to find out how to build a game of the 80s - simply using Python<sup id="fnref:ff"><a href="#fn:ff" class="footnote">5</a></sup> - read on!</p>

<h3 id="recipe-for-a-good-game">Recipe for a good game</h3>
<p>Building a videogame, textual or not, is not the typical task for a computer scientists. Then, regardless of what your goal is and the complexity of the game you have in mind to create, you must first have a clear idea of <em>how you want</em> your video game to work. In my honest opinion, a textual game must be as adventurous as possible, with all the characteristics of a classic modern rpg: a single player, items of different nature that affect the player and the environment in which he is immersed, player’s life and/or statistics that interfere in performing certain actions, a simple and clear objective, even broken up into several simple tasks, one or more maps in which to hardly extricate themselves, possibly divided into levels too.</p>

<h4 id="ingredients">Ingredients</h4>
<p>The first thing you need to build your adventure textual game is a character, usually described in the beginning of the game: this is done to help the player imagine its role in the adventure. I started with a modify version of the game description provided in the <a href="https://www.wikiraider.com/index.php/Caves">wikiraider</a> page:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to Tomb Raider I! You will interprete the role of Lara, a British archaeologist and treasure hunter, most commonly known for her discovery of several noted artefacts, including Excalibur, the fabled sword of King Arthur. You was hired by Jacqueline Natla to travel to the Andes mountain range, in Peru, in search of an artefact known as the Scion, which rests in the Tomb of Qualopec somewhere in the mountains. Accompanied by a guide you arrived at a huge pair of stone doors, the entrance to an ancient Incan civilisation. You climbed to the top of the doors and found a hidden switch that opens the doors. A pack of ferocious wolves suddenly attacked you from inside the cave. You leaped to the ground, killing the wolves in a barrage of pistol fire. However, you are too late, and your guide is dead in the snow. 
Alone, you headed into the caves in search for the village Vilcabamba.
</code></pre></div></div>

<p>What else?</p>
<ul>
  <li>An amazing story: I decided to use the Tomb Raider story because I love Tomb Raider and Lara is one of my favourite characters;</li>
  <li>Previous adventure game experience: I think this could be ufeful in further step to build your textual game but not essential ;)</li>
</ul>

<p>…and?</p>
<ul>
  <li>A Python interpreter;</li>
  <li>A little bit of automata theory;</li>
</ul>

<p>That’s all! For those who are wondering why it is necessary to have theoretical foundations on automata, I answer “because this is not a guide to build textual game for painters but computer scientists, so let’s add some nerd stuff to make things a little bit nerdy”. Just kidding. Let’s move one step forward, introducing game formalism and settings.</p>

<h3 id="formalism-and-settings">Formalism and settings</h3>
<p>In many years of study I learnt that <em>working with semantics</em> is one of the most difficult task in NLP pipeline<sup id="fnref:nlp"><a href="#fn:nlp" class="footnote">6</a></sup>: if you don’t believe me have a look to one of my <a href="https://github.com/made2591/cognitive-system-postagger">old repo</a> on POS tagging with CYK<sup id="fnref:cyk"><a href="#fn:cyk" class="footnote">7</a></sup>. The point is simple: when you write a few line of codes, it’s easy for a compiler or an interpreter to <em>understand</em> what you mean. This is because the language you use is well formalised. The natural language is not well formalised: it’s ambiguous, not deterministic, and works because human beings dialogue between each others with the help of thousand of other structures and methods to support the language. If we were to speak unambiguously without using any system of logical inference on the context, ignoring the gestures, tones of voice and facial nuances (actually, <em>understanding</em> in the same way a compiler or a code interpreter would do), probably we would take 2 hours of conversation just to say hello to a friend of ours!</p>

<p>Over the years, I like to think also thanks to the incredible work of scientists like Chomsky<sup id="fnref:nc"><a href="#fn:nc" class="footnote">8</a></sup>, it was possible to build theories on the languages, on the grammars that support the more regular parts of them and, with the help of probabilistic calculation and with complicate deterministic systems, in the end Google translate was born. But there is a problem: <em>how</em> could a game, whose input is textual, work in the early 80s? In other words, <em>how</em> could a PC with a very little computational capacity (and without any theoretical support yet) correctly interpret sentences like <code class="highlighter-rouge">jump into leaves</code> or <code class="highlighter-rouge">what is a rpbd</code> and so on. 
I didn’t want to find in some webpage a pre-packaged answer to this question, because I like challenges: so I simply thought that input sentences in textual games are always simple… and this means that maybe it was possible to model textual analysis at a lower level: instead of working on <em>semantics</em>, I realized I could work on the <em>syntax</em>: in that moment I thought I could use a finite state automa.</p>

<h4 id="the-games-skeleton-finite-state-automa">The game’s skeleton: finite state automa</h4>
<p>Ok, I will use a finite state automa to build the game: how? Let’s start with the basic concept: look at the picture.</p>

<p align="center"><img src="https://image.ibb.co/gs7zBb/automa.png" alt="perceptron" style="width: 250px; marker-top: -10px;" /></p>

<p>In a textual game you are in a situation, you can do some actions, and change the situation. This can be implemented as a simple finite state automa, in which each possible scenario is a state, with the <em>right</em> action that point to the next state in the story, and <em>epsilon</em> moves that simply don’t make any difference to your state. How do I build it? Starting from the actions: you first have to define which actions are allowed in your game. The original Tomb Raider is a free roaming game with several different kind of jump, move, climb and attack actions with many different interactions with items. If you want to create a more accurate rebuild, ok…you don’t, so just start building a simple set of action.</p>

<p>For Lara, I add to my set of allowed actions <code class="highlighter-rouge">walk</code>, <code class="highlighter-rouge">run</code>, <code class="highlighter-rouge">jump</code>, <code class="highlighter-rouge">climb</code>, <code class="highlighter-rouge">examine</code>, <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">use</code>, <code class="highlighter-rouge">shot</code> and of course <code class="highlighter-rouge">save</code><sup id="fnref:sv"><a href="#fn:sv" class="footnote">9</a></sup>. After that, you can think about the states: each state is made of a description (printed in the cli of the player), than some items and - eventually - some npc that can interact with the main player. I thought about a state as simple dictionary of actions (keys) with other states as values (other keys) to which they bring to. Than, you can define items for a state with list of keywords, and so on.</p>

<p>Ok, we found out that finite state automa could be used to build your textual game. But how can you easly create and manipulate a finite state automa from a cli? Using dot? Of course, but an easier way came to my mind. You can use a new and innovative format: a JSON file.</p>

<h4 id="the-json-game">The JSON game</h4>
<p>Before definining a state, or <code class="highlighter-rouge">step</code>, let’s start with the <code class="highlighter-rouge">player</code>: he usually has a <code class="highlighter-rouge">name</code>, <code class="highlighter-rouge">life</code>, the <code class="highlighter-rouge">level</code> and the <code class="highlighter-rouge">step</code> he reached, the <code class="highlighter-rouge">items</code> he <strong>collected</strong> over the time, and some other generic properties useful for setup gaming speed and output.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
	</span><span class="s2">"player"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> 
        </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cave"</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"life"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"made2591"</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"step"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"velocity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"debug"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>The level struct could be defined as follow:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
	</span><span class="s2">"player"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="s2">"levels"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"cave"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"levelDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome to Tomb Raider I! 
				 You will interprete the role of Lara [..]"</span><span class="p">,</span><span class="w"> 
            </span><span class="s2">"steps"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"availableActions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="s2">"examine"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> 
                        </span><span class="s2">"get"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> 
                        </span><span class="s2">"run"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10"</span><span class="p">,</span><span class="w"> 
                        </span><span class="s2">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> 
                        </span><span class="s2">"walk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10"</span><span class="p">,</span><span class="w"> 
                        </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w">
                    </span><span class="p">},</span><span class="w"> 
                    </span><span class="s2">"availableItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"footprints"</span><span class="w">
                    </span><span class="p">],</span><span class="w"> 
                    </span><span class="s2">"stepDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"There are 
                    	 some footprints coming from the North"</span><span class="w">
                </span><span class="p">},</span><span class="w"> 
                </span><span class="s2">"10"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
                </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>As you can see, some actions don’t have a step value, and this implies that those actions don’t bring you anywhere / give you anything / etc. I wrote only a few transaction to the next state, but can you can add to the dictionary as many as you want.</p>

<p><strong>NOTE</strong>: to make the game more playable, the player needs always a feedback, not only to gather new informations about the state, or even to understand more about items or interact with npc: to do that, I setup some default messages for <em>epsisol moves</em>: in the core game you can use this default message for each empty move typed by the player.</p>

<p>To summarize, what we said until now seems ok for moving action but…what about suffix and prefix, or action like <code class="highlighter-rouge">examine the footprints</code>?</p>

<h3 id="different-type-of-action">Different type of action</h3>
<p>Actually, actions to go ahead in the game (<em>aka</em> available transaction between steps in the finite state automa), are not so simple as I argued. In fact, I splitted the allowed actions set in my game into two <em>game-agnostic</em> set.</p>

<h4 id="move-actions">Move actions</h4>
<p>The move action are simple: you can <code class="highlighter-rouge">walk/run/jump</code> in all direction (<code class="highlighter-rouge">straight/back/left/right</code>). To be more confortable, our core allow the player typing even the simple move action <code class="highlighter-rouge">move</code> or <code class="highlighter-rouge">run</code>, mapping this to straight direction by default.</p>

<h4 id="interaction-actions">Interaction actions</h4>
<p>The interaction actions are actions that <em>may</em> require some additionatl information: why may? Because, I thought that could be useful to be able to <code class="highlighter-rouge">examine</code> both a room, to gather more information about the room itself, and a specific item in the scene, to get more information about the next steps to do. You can think about interation actions as a <em>jump to a secondary chain of steps in the level</em> as shown in the schema below:</p>

<p align="center"><img src="https://image.ibb.co/hPR4uw/automa_epsilon_move.png" alt="perceptron" style="width: 650px; marker-top: -10px;" /></p>

<p>In this case, the chain is made of one single <em>step</em>: actually, it is not a real step, because if the <em>secondary story</em> is made of a single assertion that need to help the player to enrich his knowledge about the state, you don’t need a state. To handle this situation, I created a step, I print the step description, but I don’t change the state, without jumping to the empty state. If the optional / secondary chain is made of more than one action - find a secret or optional item such as a medikit, you can create a real chain of effective states and let jump to the main story from the last state of the chain - of course if it is plausible in the history. In the example above, the information about footprints origin could help the player imagine an opponent npc to kill in the garden and check if the he has guns, or bullets, or whatever, to kill him.</p>

<h3 id="state-with-consequences">State with consequences</h3>
<p>Some state has consequences: you might thinking “what do you mean?!”. Ok, let say that you jump into a state like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Three wolves are approaching in a hurry, they will attack you!
</code></pre></div></div>

<p>and you’re ok, because a finite-state-automa based textual game is a game with a sort of stop motion graphic setup XD but remember…you are Lara Croft and those wolves are real. It is very likely that in the next state, or after a few, you will die… Fortunately, you are the programmer of the game, so the first problem you have to deal with is “how can I die in a finite state automa?”</p>
<ul>
  <li>Option 1: in the next step you gonna die. This is simple to implement but wolves, or falling from a too high platform, or the insect sting don’t hurt you with the same intensity in real world, and even if this solution will end in a “game over state” - in other words, you can’t be wrong without die - <em>one-shot</em> way;</li>
  <li>Option 2: you create <em>consequences</em> in each steps;</li>
</ul>

<p>Look at the code:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
	</span><span class="s2">"player"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="s2">"levels"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"cave"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"levelDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome [..]"</span><span class="p">,</span><span class="w"> 
            </span><span class="s2">"steps"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"availableActions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> 
                    </span><span class="s2">"availableItems"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"footprints"</span><span class="p">],</span><span class="w"> 
                    </span><span class="s2">"stepDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The wolves are attacking you!"</span><span class="w">
                    </span><span class="s2">"consequences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"life"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">-10</span><span class="w"> </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"10"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w">
                </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>With a simple field you are done! Due to the consequences on some properties of the character, it will be easy to recreate the effect of attacks / falls / other types of interaction between the player and npc, or elements in the scene, describing the effects at each progression of state, through steps evolution in the automa. For example, with this mode, you can easly simulate a poisoning, as a consequence that for 10 steps decreases life according to a geometric series.</p>

<h4 id="target">Target</h4>
<p>The goal must always be clear: don’t write too complicated descriptions to imagine, and always give a suggestion in each state about what the next move might be. A very important thing is the introduction of phrases that bind the various environments through which the player moves: for instance, sentences like</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are some footprints coming from the North
</code></pre></div></div>

<p>are perfect to suggest without any consequences that maybe the North will be a direction involved in exploration (even if not exactly in the further step, but in some others in the story). Details can be left to secondary epsilon moves that add elements of the scene only if the player considers it necessary through actions such as <code class="highlighter-rouge">examine</code>.</p>

<h4 id="non-player-character-npc">Non-player character (NPC)</h4>
<p>To describe the behavior of the npc and the effects of the latter on the main player, you can use lists and dictionaries. For example, once the story was written, to begin with it is possible to create a list of all the entities that could interact with the main player during the evolution of the game. It is also possible to standardize some behaviors by creating distinct types of npc: for example, ferocious animals attacks provide damage to the player more or less always with the same intensity, or increasing intensity as the game progresses, or randomly in a given range. For the caves level of Tomb Raider, I defined the following npc(s):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NPC_KEYWORDS = ["wolf", "wolves", "bear", "bears", "bat", "bats"]
</code></pre></div></div>

<p>Also arrows from walls can hurt you, so…try to model different type of npc if you want!</p>

<h4 id="actions">Actions</h4>
<p>The actions are simple transactions to new states: I use items list to prohibit the player from, for instance, getting more than one medikit, and so on. The list of items in a scene (in a state) can also be useful to establish on which entities presented in the description it is possible to perform interaction actions (get, use, etc). You can defined as many actions as you want, as I said before. To help the player remember how to use the actions, I always make available in a help command that allows you to scroll in the style of man the list of actions available in the game, with instructions on the uses and effects of the same.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="s2">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"walk"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"usageMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The WALK command lets Lara moving slow into the scenario. If Lara is not stucked by something in the scene, or there's any reason why she can not move, you will be always able to walk. You can move in a specific direction in the scene using the command WALK [STRAIGHT/DOWN/LEFT/RIGHT]. Note: if you type and execute WALK, you will WALK STRAIGHT by default."</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"climb"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"usageMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The CLIMB command lets Lara climb up/on something in the scene. You won't be always able to climb: Lara need something to climb up/on to complete this action. You can climb in the scene using the command CLIMB [UP/ON] [SOMETHING]. Note: if you type and execute CLIMB without specific element, Lara won't complete the action."</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="s2">"examine"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"usageMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The EXAMINE action is useful to help you explore the scene or a particular item in the scene. You can examine the scene using simply EXAMINE. If you try to examine an item you don't have in your pocket, the examine action will fail and nothing happens. You can examine an item using the command EXAMINE [ITEM_NAME] with the name of an item in the scene."</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="s2">"get"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"usageMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The GET action is used to get an item from the scene. If there are no items in the scene, nothing will be added to your pocket. You can get an item using the command GET [ITEM_NAME] with the name of an item in the scene."</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="s2">"use"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"usageMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The USE action is used to use an item you hold. If you can't use the item in the scene than the item will remain in your pocket. You can use an item using the command USE [ITEM_NAME] with the name of an item in the scene."</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="p">[</span><span class="err">..</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span></code></pre></figure>

<h4 id="items">Items</h4>
<p>The items interact with the player: eventually, they can also enable it for actions that are not available in a particular state. For example, it is not possible to light a flare to illuminate the scene if the player does not have a flare in the backpack, and so on. Another way to interact with items is to setup <code class="highlighter-rouge">REGEX</code> for actions that involve them, but I think it is more complicated. Write to me if you want more detail of these XD. <code class="highlighter-rouge">REGEX</code> could be useful in main to parse the sentece typed in input and loop through the automa.</p>

<h4 id="conclusion-first-part">Conclusion (first part)</h4>
<p>Until now I wrote about how to create the logic behind a text game using finite-state automata: in the next paragraph I will talk about how I started working at Tomb Raider!</p>

<h3 id="tomb-raider">Tomb Raider</h3>
<p>Tomb Raider is a very difficult and complicated game to model: Lara can move through many actions, the set of items and weapons available is very extensive after a few hours of play, the enigmas are difficult and it is complicated to move through the rooms to reach levers, buttons, platforms and gear systems. Moreover, it is a non-textual game, so you need to replay the game and manually describe all the scenes from scratch in a new form. To help me with this difficult task, I wrote a simple Python script that does nothing more than generate a story <em>starting from a text</em>, with some basic default actions to progress through the states, and some tricks to set some of the properties described above.</p>

<h4 id="a-parser-to-find-them-all">A parser to find them all</h4>
<p>Tomb Raider is one of those games so complex that it is not difficult to imagine that a lot of online solutions have been written: looking, I found in <a href="https://www.wikiraider.com/">wikirider</a> a good example to start from - even if today I do not consider it the best source. In any case, what we need is a description of the game. For starters, I used the <a href="https://www.wikiraider.com/index.php/Walkthrough:Caves">caves</a> walkthrough page as source. After the copy of the plaintext from the HTML page to a txt file, I used the following to create my draft version of states:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># separate lines</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./levels/caves.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	<span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
	<span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
		<span class="n">steps</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)</span>
<span class="c"># clean phase</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">""</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">steps</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">""</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span></code></pre></figure>

<p>The last line cleans the states list (list of sentences in my file) removing the empty lines and the titles. After that, you can create the steps for the level and also setup items / consequences looking npc and items in a (previously initialized) npc and items list of keywords. An example:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>

	<span class="c"># create level structure</span>
	<span class="n">GAME_STRUCTURE</span><span class="p">[</span><span class="s">"levels"</span><span class="p">][</span><span class="s">"cave"</span><span class="p">][</span><span class="s">"steps"</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">"stepDescription"</span> <span class="p">:</span> <span class="n">step</span><span class="p">,</span>
		<span class="s">"availableItems"</span> <span class="p">:</span> <span class="p">[],</span>
		<span class="s">"availableActions"</span> <span class="p">:</span> <span class="p">{},</span>
	<span class="p">}</span>

	<span class="c"># insert items</span>
	<span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">ITEMS_KEYWORDS</span><span class="p">:</span>
		
		<span class="c"># check if keyword of item appears in step description and it not already added to items list</span>
		<span class="k">if</span> <span class="n">keyword</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">GAME_STRUCTURE</span><span class="p">[</span><span class="s">"levels"</span><span class="p">][</span><span class="s">"cave"</span><span class="p">][</span><span class="s">"steps"</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">"availableItems"</span><span class="p">]:</span>

			<span class="c"># add to items</span>
			<span class="n">GAME_STRUCTURE</span><span class="p">[</span><span class="s">"levels"</span><span class="p">][</span><span class="s">"cave"</span><span class="p">][</span><span class="s">"steps"</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">"availableItems"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

	<span class="c"># create level structure</span>
	<span class="n">GAME_STRUCTURE</span><span class="p">[</span><span class="s">"levels"</span><span class="p">][</span><span class="s">"cave"</span><span class="p">][</span><span class="s">"steps"</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">"availableActions"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

		<span class="s">"walk"</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="n">STEP_OFFSET</span><span class="p">),</span>
		<span class="s">"walk straight"</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="n">STEP_OFFSET</span><span class="p">),</span>
		<span class="p">[</span><span class="o">..</span><span class="p">]</span>

	<span class="n">index</span> <span class="o">+=</span> <span class="n">INDEX_OFFSET</span></code></pre></figure>

<p>If you have a look to my previous examples, I setup state identifier with an <code class="highlighter-rouge">INDEX_OFFSET</code> (value = 10). Why? Because after the automatic phase, you need to add / modify each steps to create a real gaming experience, and in the main loop through each state could be usefull to have keys that can be ordered but also the ability to insert new states (primary or secondary) without breaking the original order.</p>

<h4 id="formalize-situations">Formalize situations</h4>
<p>The next step in creating a safe and easy way to expand and test the entire game-experience, is to formalize the several situations ih which the player could come across: the discovery of a medikit, the attack by an NPC. Every situation is repeatable by abstracting to the automaton that describes its evolution, and these automata can then be populated with distinct descriptions in order to be reused when necessary during the description of each level. And that’s how I now have to formalize separate automata and update my guide … XD</p>

<h4 id="conclusion-second-part">Conclusion (second part)</h4>
<p>If you enjoy this article, please share it! <a href="http://github.com/made2591/tomb-raider">Here</a> the source code of my work-in-progress Tomb Raider textual version.</p>

<p>Thank you everybody for reading!</p>

<div class="footnotes">
  <ol>
    <li id="fn:p1">
      <p>Yes, it’s incredible. Playstation 1 goes back to 90s. The console was released on 3 December 1994 in Japan, 9 September 1995 in North America, 29 September 1995 in Europe, and for 15 November 1995 in Australia - <a href="https://en.wikipedia.org/wiki/PlayStation_(console)">source and more</a>&nbsp;<a href="#fnref:p1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:p2">
      <p>The Playstation 2 belongs to millennials OMG - <a href="https://en.wikipedia.org/wiki/PlayStation_2">source and more</a>&nbsp;<a href="#fnref:p2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:gb">
      <p>The first version of Game Boy is older than PS1 - <a href="https://en.wikipedia.org/wiki/Game_Boy">source and more</a>&nbsp;<a href="#fnref:gb" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:bbt">
      <p>The Big Bang Theory, <a href="http://www.imdb.com/title/tt1632243/">The Irish Pub Formulation</a>, Season 4 Episode 6&nbsp;<a href="#fnref:bbt" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:ff">
      <p>I would like to work to more modern version with Docker and Spring Boot!&nbsp;<a href="#fnref:ff" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:nlp">
      <p>Read more about <a href="https://en.wikipedia.org/wiki/Natural_language_processing">Natural language processing</a>&nbsp;<a href="#fnref:nlp" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:cyk">
      <p>Ok, this could be hard for those who are new to NLP problems…be careful: <a href="https://en.wikipedia.org/wiki/CYK_algorithm">CYK</a>&nbsp;<a href="#fnref:cyk" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:nc">
      <p>Pioner in language theory <a href="https://en.wikipedia.org/wiki/Noam_Chomsky">Wikipedia</a>&nbsp;<a href="#fnref:nc" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:sv">
      <p>To save the game in the original Tomb Raider (PS1 version) you need some crystal you encounter during the levels.&nbsp;<a href="#fnref:sv" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


<div class="comments">
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'made2591';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

<hr/>


  
    <div class="post-navs row">
      
        <div class="col-md-6 post-nav">

          <h3 class="section-header">
            Older
            <span class="text-muted"> &middot; </span>
            <a href="/archive">View Archive (35)</a>
          </h3>

          <h2 class="post-title-link"><a href="/posts/merry-christmas">Best wishes for Christmas holidays!</a></h2>
          <h3 id="merry-christmas-by-nerds">Merry Christmas by nerds</h3>
<p>Here we are!! Christmas holidays are coming and it’s time to collect nerd greetings for nerd friends! In this article I have collected some of my favorites: starting from css to the most unhealthy c code in the world, I hope you enjoy these repositories / snippets / gist / sketch! Best wishes for happy holidays!</p>


        </div>
      
      

        <div class="col-md-6 post-nav">
          <h3 class="section-header">
            Newer
            
          </h3>

          <h2 class="post-title-link"><a href="/posts/network-layers-1">A journey through the network - Layer 1</a></h2>
          <h3 id="a-journey-through-the-network---layer-1">A journey through the network - Layer 1</h3>
<p>Before the Christmas holidays, I wrote an article about the network: yes. The network is that part of computer science that is no longer considered fundamental as it should, and I must admit that I learn it every day at my expense: as an old friend always says to me “<em>the network is the concept on which everything is based, describes how the body works: after that, you can also become a gastroenterologist, but you will always need to know how the body works”</em>. I think he’s right. As I was saying, I wrote an article about that: it’s a sort of overview and technical / historical introduction on the ISO / OSI and TCP / IP protocols. For those who missed the introduction, <a href="https://made2591.github.io/posts/network-layers-0">here</a> the link. Despite my lack of experience, I promised myself, as far as possible, with the little time available, to retrace the various levels of the network from a theoretical point of view without going into too much detail, also trying to identify the most used commands, understand the level at which they operate and the functioning of the parameters supported by them. It took me a lot of time … but finally, the post on level one is ready.
As a main source I use <a href="https://www.amazon.it/gp/product/9332518742/ref=oh_aui_detailpage_o01_s00?ie=UTF8&amp;psc=1">Computer Networks</a> and <a href="https://www.amazon.it/gp/product/9332535957/ref=oh_aui_detailpage_o02_s00?ie=UTF8&amp;psc=1">TCP/IP Illustrated</a>. In this article, I will talk about layer 0, the lowest in the ISO / OSI stack. Enjoy the reading!</p>


        </div>
      
    </div>
  



          <div id="footer">
<hr/>
  <div class="pull-left">
    &copy;2019.
    Built with <a href="http://jekyllrb.com/">Jekyll</a> and
    <a href="https://github.com/kirqe/autm-rb">Autm-rb</a>. Thanks to <a href="https://github.com/kirqe">kirqe</a>.
  </div>

  <div class="pull-right">
    <span class="credits pull-right social">
      
        
          <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
        
      
        
          <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
        
      
        
          <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
        
      
        
          <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
        
      
    </span>
  </div>
</div>

        </section>
    </div>
    </div>
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/javascripts/bootstrap.min.js"></script>
    <!-- Place your <script> tags here. -->

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script id="dsq-count-scr" src="//made2591-github-io.disqus.com/count.js" async></script>

<!-- disqus comment counter -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'made2591-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.type = 'text/javascript';
	    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
</script>
<!-- /disqus comment counter -->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111283556-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111283556-1');
</script>
<!-- /google analytics -->

  </body>
</html>
