<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <!--<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M8WBXH7');</script>-->
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href=/public/stylesheets/bs.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/styles.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/pygment_trac.css?random=@Environment.TickCount>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="canonical" href="made2591.github.io/posts/aws-lambda">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <link rel="icon" type="image/x-icon"  href="/favicon.ico" />
    <title>AWS Lambda, GoLang and Grafana to perform sentiment analysis for your company / business | Matteo Madeddu</title>
    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <!--<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8WBXH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrapper">
        <section>
          <div id="header">
  <h1>
    <a id="sitename" href="">Matteo Madeddu</a>
  </h1>

  <!-- Add something about you in p tag-->
  <p>Mac OS lover, Docker fan, Go explorer, Python geek, Trello addicted.</p>
  <hr/>

  <span class="credits pull-left">
    
      <a href="/">Home</a>  | 
    
      <a href="/blog">Blog</a>  | 
    
      <a href="/archive">Archive</a>  | 
    
      <a href="/about">About</a>  | 
    
      <a href="/matteo_madeddu_cv.pdf">Resume</a>  | 
    
      <a href="/quotes">Quotes</a> 
    
  </span>

  <span class="credits pull-right social">
    
      
        <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
      
    
      
        <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
      
    
      
        <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
      
    
      
        <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
      
    
  </span>


</div>


          <div class="post-title">
    <h1>AWS Lambda, GoLang and Grafana to perform sentiment analysis for your company / business</h1>
    <p class="text-muted">
    


    30 Jan 2018
    
     | <i class="fa fa-comment"></i> <a class="text-muted" href="/posts/aws-lambda/#disqus_thread"></a>
    

    
      | <i class="fa fa-tag"></i>
      
        <a class="text-muted" href="/tags/#coding ">coding</a>,
      
        <a class="text-muted" href="/tags/#aws ">aws</a>,
      
        <a class="text-muted" href="/tags/#lambda ">lambda</a>,
      
        <a class="text-muted" href="/tags/#golang ">golang</a>,
      
        <a class="text-muted" href="/tags/#grafana ">grafana</a>,
      
        <a class="text-muted" href="/tags/#sentiment ">sentiment</a>,
      
        <a class="text-muted" href="/tags/#analysis ">analysis</a>
      
    
  </p>
</div>

  <h3 id="introduction">Introduction</h3>
<p>In this article I will talk about my experience with AWS Lambda + API Gateway, GoLang (of course) and Grafana to build a sentiment analysis tool over customizable topics. Who should you read this post? Don’t know, maybe a CIO, a CTO, a CEO, a generic Chief or a MasterChef, for sure an AWS and GoLang fan like me. First of all: to better understand how to use Elasticsearch, read my previous post <a href="https://made2591.github.io/posts/elasticnas">Elasticsearch over My home Network Attached Storage</a>: it’s not so exciting as it seems, but you will have a general idea about what is Elasticsearch and how can you use it. Second: if you don’t know about AWS Lambda, study it. I personally believe that it represents one of the most interesting services currently offered by AWS: as they state, <em>AWS Lambda lets you run code without provisioning or managing servers</em>. You pay only for the compute time you consume and there is no charge when your code is not running. The amazing thing is that with a Free Tier trial you have 1 milions requests for free - O.O - to run code of any type of application or backend service - all with zero administration: you just upload your code - unfortunately the online editor for GoLang is not supported yet - and AWS Lambda<sup id="fnref:lambda"><a href="#fn:lambda" class="footnote">1</a></sup> takes care of everything required to run and scale your code with high availability. You can even set up your code to automatically trigger from other AWS services - as I have done with API Gateway - or call it directly from any web or mobile app. And…last but definetly not the least, why I’m writing this post!? Because starting from <a href="https://aws.amazon.com/it/blogs/compute/announcing-go-support-for-aws-lambda/">15 January 2018</a>, AWS Lambda support GoLang!!!</p>

<p>Ingredients after the image.</p>

<p align="center"><img src="https://images.everyeye.it/img-notizie/tramite-gli-steam-awards-giocatori-chiedono-arrivo-half-life-3-v3-278335-1280x720.jpg" style="width: 100%; marker-top: -10px;" /></p>

<h3 id="ingredients">Ingredients</h3>
<p>For this article, you will need the following:</p>
<ul>
  <li>A Grafana + Elasticsearch setup (wherever you want: if you want to run both of them locally, go <a href="https://github.com/ftes/grafana-elasticsearch-docker">here</a>;</li>
  <li>An <a href="http://aws.amazon.com">AWS account</a> (free tier it’s ok, but API Gateway is not included);</li>
  <li>Python or Bash to perform queries;</li>
  <li>A <a href="http://newsapi.org">Newsapi</a> account to gather news from several sources (the free tier it’s ok for our purpose);</li>
  <li>A <a href="http://aylien.com">Aylien</a> account to do some sentiment analysis (the free tier it’s ok for our purpose);</li>
</ul>

<h3 id="recipe">Recipe</h3>
<p>There are a lot of quite simple steps. I recommend you to pay a lot of attention with AWS. You always have to know exactly what are you doing, to avoid surprise in billing in the end of the month. Fortunately, there are a lot of documentations on Amazon official site, so you only have to read them.</p>

<h4 id="17-create-an-aws-account">1/7 Create an AWS Account</h4>
<p>Create an AWS Account is simple, you only need to have a credit cart and no fear of Amazon (what?!) :D You can start from <a href="http://aws.amazon.com">here</a>. After the creation, I strongly suggest to study a little more how the IAM Roles work. After you have created your account, you can start from the <a href="https://console.aws.amazon.com/iam/">IAM Dashboard</a> by following the 5 points to ensure your account is secured. I am talking about</p>

<p align="center"><img src="http://image.ibb.co/mL3POm/aws_iam.png" style="width: 100%; marker-top: -10px;" /></p>

<p>Following those steps you guarantee - in practise - to:</p>
<ul>
  <li>Create a secondary user with admin rights, possibly with MFA enabled (I use <a href="http://thomasrzhao.com/2stp-support/">2stp</a> even if it is not supported anymore, because it works and it includes what I need - and nothing more - from a 2-step virtual authenticator device);</li>
  <li>Create IAM password policy and start to understand the use of groups to assign permissions;</li>
</ul>

<h4 id="27-create-newsapi-and-aylien-account">2/7 Create Newsapi and Aylien Account</h4>
<p>These services are replaceable with any other service you want to lambd-_ize_. I chose the first one because it is really a great service for aggregating news and highlights from different sources. I chose the second one because the service simply work for my trial purpose, but I would like to compare it with Google Cloud Platform and Microsoft Azure as soon as possible, and I already have the idea of who will be the winner (spoiler: in my opinion it is not Google).
Start <a href="http://newsapi.org">here</a> for news and <a href="http://aylien.com">here</a> for sentiment.</p>

<h4 id="37-build-news-gatherer-over-aws-lambda">3/7 Build News gatherer over AWS Lambda</h4>
<p>Lambda currently supports different languages: C#, Java, Node.js, Python and now Go. First of all, you need to know how to write code: online editor is not supported yet so you will have to write your lambda offline. A Lambda ready GoLang file is a single <code class="highlighter-rouge">.go</code> file with a function, the <code class="highlighter-rouge">handler</code> and a <code class="highlighter-rouge">main</code> function to link the handler function to the lambda. And that’s all. The only dependencies you need to install, if you want to run your lambda locally, is the <code class="highlighter-rouge">aws-lambda-go</code> sdk provided by Amazon and available on Github.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">go get github.com/aws/aws-lambda-go/lambda</code></pre></figure>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"os"</span><span class="x">
	</span><span class="s">"fmt"</span><span class="x">
	</span><span class="s">"time"</span><span class="x">
	</span><span class="s">"errors"</span><span class="x">
	</span><span class="s">"strconv"</span><span class="x">
	</span><span class="s">"net/http"</span><span class="x">
	</span><span class="s">"io/ioutil"</span><span class="x">
	</span><span class="s">"encoding/json"</span><span class="x">

	</span><span class="s">"github.com/aws/aws-lambda-go/lambda"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="n">API_KEY</span><span class="x">      </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"API_KEY"</span><span class="p">)</span><span class="x">
	</span><span class="n">API_URL</span><span class="x">      </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"API_URL"</span><span class="p">)</span><span class="x">
	</span><span class="n">API_DATE_FMT</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"API_DATE_FMT"</span><span class="p">)</span><span class="x">
	</span><span class="n">ErrorBackend</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"Something went wrong"</span><span class="p">)</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Request</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Q</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x"> 		 		</span><span class="s">`json:"q"`</span><span class="x">
	</span><span class="n">Sources</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x">  		</span><span class="s">`json:"sources"`</span><span class="x">  </span><span class="c">// comma separated https://newsapi.org/sources</span><span class="x">
	</span><span class="n">Domains</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x">  		</span><span class="s">`json:"domains"`</span><span class="x">  </span><span class="c">// comma separated https://newsapi.org/domains</span><span class="x">
	</span><span class="n">From</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x">     		</span><span class="s">`json:"from"`</span><span class="x">
	</span><span class="n">To</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x">       		</span><span class="s">`json:"to"`</span><span class="x">
	</span><span class="n">Language</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x"> 		</span><span class="s">`json:"language"`</span><span class="x">
	</span><span class="n">SortBy</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x">   		</span><span class="s">`json:"sortBy"`</span><span class="x">
	</span><span class="n">PageSize</span><span class="x"> </span><span class="o">*</span><span class="kt">int</span><span class="x">    		</span><span class="s">`json:"pageSize"`</span><span class="x">
	</span><span class="n">Page</span><span class="x"> </span><span class="o">*</span><span class="kt">int</span><span class="x">   	 		</span><span class="s">`json:"page"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">NewsApiResponse</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Status</span><span class="x"> </span><span class="kt">string</span><span class="x">   		</span><span class="s">`json:"status"`</span><span class="x">
	</span><span class="n">News</span><span class="x"> </span><span class="p">[]</span><span class="n">News</span><span class="x"> 			</span><span class="s">`json:"articles"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Source</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">ID</span><span class="x">   </span><span class="kt">string</span><span class="x"> 			</span><span class="s">`json:"id"`</span><span class="x">
	</span><span class="n">Name</span><span class="x"> </span><span class="kt">string</span><span class="x"> 			</span><span class="s">`json:"name"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">News</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Source</span><span class="x">	  	</span><span class="n">Source</span><span class="x">      </span><span class="s">`json:"source"`</span><span class="x">
	</span><span class="n">Author</span><span class="x">    	</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"author"`</span><span class="x">
	</span><span class="n">Title</span><span class="x">     	</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"title"`</span><span class="x">
	</span><span class="n">Description</span><span class="x"> </span><span class="kt">string</span><span class="x">  	</span><span class="s">`json:"description"`</span><span class="x">
	</span><span class="n">URL</span><span class="x">       	</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"url"`</span><span class="x">
	</span><span class="n">Image</span><span class="x">     	</span><span class="kt">string</span><span class="x"> 		</span><span class="s">`json:"urlToImage"`</span><span class="x">
	</span><span class="n">Published</span><span class="x"> 	</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="x">	</span><span class="s">`json:"publishedAt"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">GatherRecentNewsAboutTopic</span><span class="p">(</span><span class="n">request</span><span class="x"> </span><span class="n">Request</span><span class="p">)</span><span class="x"> </span><span class="p">([]</span><span class="n">News</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">

	</span><span class="c">// concat api key</span><span class="x">
	</span><span class="n">url</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="n">API_URL</span><span class="p">,</span><span class="x"> </span><span class="n">API_KEY</span><span class="p">)</span><span class="x">

	</span><span class="c">// create client to ask for apis</span><span class="x">
	</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">http</span><span class="o">.</span><span class="n">Client</span><span class="p">{}</span><span class="x">

	</span><span class="c">// error in external source</span><span class="x">
	</span><span class="n">req</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span><span class="x"> </span><span class="n">url</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="p">)</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="p">[]</span><span class="n">News</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request parameters</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Q</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"q"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request source</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Sources</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"sources"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Sources</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request domains</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Domains</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"domains"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Domains</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request from</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">From</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="k">if</span><span class="x"> </span><span class="n">t</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">API_DATE_FMT</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">From</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"from"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="n">API_DATE_FMT</span><span class="p">))</span><span class="x">
			</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
		</span><span class="p">}</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request to</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">To</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="k">if</span><span class="x"> </span><span class="n">t</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">API_DATE_FMT</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">To</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
			</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"to"</span><span class="p">,</span><span class="x"> </span><span class="n">t</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="n">API_DATE_FMT</span><span class="p">))</span><span class="x">
			</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
		</span><span class="p">}</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request language</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Language</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"language"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Language</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request sort by</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">SortBy</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"sortBy"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">SortBy</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request page size</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">PageSize</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"pageSize"</span><span class="p">,</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">PageSize</span><span class="p">))</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// parse request page</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Page</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">p</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"page"</span><span class="p">,</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Page</span><span class="p">))</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">p</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// debug</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="p">)</span><span class="x">

	</span><span class="c">// make request and defer response</span><span class="x">
	</span><span class="n">resp</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="p">[]</span><span class="n">News</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="k">defer</span><span class="x"> </span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

	</span><span class="c">// parse news results</span><span class="x">
	</span><span class="k">var</span><span class="x"> </span><span class="n">data</span><span class="x"> </span><span class="n">NewsApiResponse</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="p">[]</span><span class="n">News</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// return response</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="n">data</span><span class="o">.</span><span class="n">News</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="x">

</span><span class="p">}</span><span class="x">

</span><span class="c">// handle request</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">

	</span><span class="c">// handle request</span><span class="x">
	</span><span class="n">lambda</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">GatherRecentNewsAboutTopic</span><span class="p">)</span><span class="x">

</span><span class="p">}</span></code></pre></figure>

<p>I also found <a href="https://github.com/lambci/docker-lambda">this</a> beautiful docker image that let you test your lambda (and support also GoLang) with a single docker run. You can pass the parameters as a string (payload requests), as shown in the method above: of course, you first have to compile your lambda for linux.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-o</span> MyCompiledLambda MyLambda.go

docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="nv">$PWD</span>:/var/task lambci/lambda:go1.x MyCompiledLambda <span class="s1">'{"parameter": "value"}'</span></code></pre></figure>

<p>To upload your Lambda in AWS, in the creation steps specify you want to upload a Go 1.x Lambda, then zip your build (in the example, <code class="highlighter-rouge">MyCompiledLambda</code>)</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">zip MyCompiledLambda.zip MyCompiledLambda</code></pre></figure>

<p>and upload from an S3 bucket or manually.</p>

<p align="center"><img src="http://image.ibb.co/mJqX9R/aws_lambda_2.png" style="width: 100%; marker-top: -10px;" /></p>

<p><strong>NOTE</strong>: the most important things is to setup the handler name to the name of the compiled binary inside your zip - exactly the same name. Otherwise, during testing a path error will be arised because AWS will look for the wrong file name to run your lambda.</p>

<p>As you can see from the code above, there are environment variables to setup API KEY and API Endpoint (whatever your want). From the Lambda setup page you can setup this environment variable to let your code gather the information from AWS, in a secure way.</p>

<p align="center"><img src="http://image.ibb.co/c3vh9R/aws_env.png" style="width: 100%; marker-top: -10px;" /></p>

<p>After you have succesfully setup your lambda with the right execution role (have a look at the documentation step, or follow the wizard to automatically create an execution role), you can test your Lambda configuring and using the test menu near to the save button in the right corner of the page. You can click on create your test (they will be available for each lambda separately), you can specify the same payload - you passed before as parameter - to the lambda as a request payload in the editor - using json format.</p>

<p align="center"><img src="http://image.ibb.co/mWus9R/aws_test.png" style="width: 100%; marker-top: -10px;" /></p>

<h4 id="47-build-sentiment-analyzer-over-aws-lambda">4/7 Build Sentiment analyzer over AWS Lambda</h4>
<p>I build a second AWS Lambda to create a sentiment analyzer that take advantage of free tier plan kindly granted by <a href="http://aylien.com">Aylien Team</a>. The code below:</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"errors"</span><span class="x">
	</span><span class="s">"net/http"</span><span class="x">
	</span><span class="s">"os"</span><span class="x">

	</span><span class="s">"github.com/AYLIEN/aylien_textapi_go"</span><span class="x">
	</span><span class="s">"github.com/aws/aws-lambda-go/lambda"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="n">AYLIEN_API_URL</span><span class="x">                </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AYLIEN_API_URL"</span><span class="p">)</span><span class="x">
	</span><span class="n">AYLIEN_API_KEY</span><span class="x">                </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AYLIEN_API_KEY"</span><span class="p">)</span><span class="x">
	</span><span class="n">AYLIEN_API_ID</span><span class="x">                 </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AYLIEN_API_ID"</span><span class="p">)</span><span class="x">
	</span><span class="n">SentimentAnalysisErrorBackend</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"Something went wrong"</span><span class="p">)</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Request</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Text</span><span class="x">     </span><span class="o">*</span><span class="kt">string</span><span class="x"> </span><span class="s">`json:"text"`</span><span class="x">
	</span><span class="n">Url</span><span class="x">      </span><span class="o">*</span><span class="kt">string</span><span class="x"> </span><span class="s">`json:"url"`</span><span class="x">
	</span><span class="n">Mode</span><span class="x">     </span><span class="o">*</span><span class="kt">string</span><span class="x"> </span><span class="s">`json:"mode"`</span><span class="x">
	</span><span class="n">Language</span><span class="x"> </span><span class="o">*</span><span class="kt">string</span><span class="x"> </span><span class="s">`json:"language"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">SentimentAnalysisOverRequest</span><span class="p">(</span><span class="n">request</span><span class="x"> </span><span class="n">Request</span><span class="p">)</span><span class="x"> </span><span class="p">(</span><span class="n">textapi</span><span class="o">.</span><span class="n">SentimentResponse</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">

	</span><span class="c">// concat api key</span><span class="x">
	</span><span class="n">auth</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">textapi</span><span class="o">.</span><span class="n">Auth</span><span class="p">{</span><span class="n">AYLIEN_API_ID</span><span class="p">,</span><span class="x"> </span><span class="n">AYLIEN_API_KEY</span><span class="p">}</span><span class="x">

	</span><span class="c">// error in external source</span><span class="x">
	</span><span class="n">_</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span><span class="x"> </span><span class="n">AYLIEN_API_URL</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="p">)</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">textapi</span><span class="o">.</span><span class="n">SentimentResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">SentimentAnalysisErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// create client to ask for apis</span><span class="x">
	</span><span class="n">client</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">textapi</span><span class="o">.</span><span class="n">NewClient</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span><span class="x"> </span><span class="no">true</span><span class="p">)</span><span class="x">

	</span><span class="c">// error in external source</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="n">text</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">""</span><span class="x">
	</span><span class="n">url</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">""</span><span class="x">
	</span><span class="n">mode</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">""</span><span class="x">
	</span><span class="n">lang</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">"auto"</span><span class="x">

	</span><span class="c">// parse request parameters</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Text</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">text</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Text</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Url</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">url</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Url</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Mode</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">mode</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Mode</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Language</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">lang</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">Language</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// create sentiment parameters</span><span class="x">
	</span><span class="n">sentimentParams</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">textapi</span><span class="o">.</span><span class="n">SentimentParams</span><span class="p">{</span><span class="n">Text</span><span class="o">:</span><span class="x"> </span><span class="n">text</span><span class="p">,</span><span class="x"> </span><span class="n">URL</span><span class="o">:</span><span class="x"> </span><span class="n">url</span><span class="p">,</span><span class="x"> </span><span class="n">Language</span><span class="o">:</span><span class="x"> </span><span class="n">lang</span><span class="p">,</span><span class="x"> </span><span class="n">Mode</span><span class="o">:</span><span class="x"> </span><span class="n">mode</span><span class="p">}</span><span class="x">

	</span><span class="c">// return sentiment</span><span class="x">
	</span><span class="n">sentiment</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Sentiment</span><span class="p">(</span><span class="n">sentimentParams</span><span class="p">)</span><span class="x">

	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">textapi</span><span class="o">.</span><span class="n">SentimentResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">SentimentAnalysisErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// return response</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="o">*</span><span class="n">sentiment</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="x">

</span><span class="p">}</span><span class="x">

</span><span class="c">// handle request</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">

	</span><span class="c">// handle request</span><span class="x">
	</span><span class="n">lambda</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">SentimentAnalysisOverRequest</span><span class="p">)</span><span class="x">

</span><span class="p">}</span></code></pre></figure>

<h4 id="57-setup-api-gateway">5/7 Setup API Gateway</h4>
<p>First, you need to create an API Endpoint. This is simple, you have to go <a href="https://console.aws.amazon.com/apigateway/">here</a> and click on “Create API” button.</p>

<p align="center"><img src="http://image.ibb.co/ht88im/aws_api.png" style="width: 100%; marker-top: -10px;" /></p>

<p>After that, you have to create a Resource clicking on the action menu and specifying your api endpoint. Then click on “Create Resource”.</p>

<p align="center"><img src="http://image.ibb.co/dZzW3m/aws_resource.png" style="width: 100%; marker-top: -10px;" /></p>

<p>You can now create your “Action Method”: as integration type choose “Lambda Function”, then specify the region you deployed your lambda and the Lambda function (it should appear).</p>

<p align="center"><img src="http://image.ibb.co/bBzTG6/aws_method.png" style="width: 100%; marker-top: -10px;" /></p>

<p>When you will click on create, a popup will appear to warn you that the action will setup the execution role for the API Gateway service - don’t remember exactly the step, eventually you can create your onw policy for API Gateway following the <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-with-lambda-integration.html">Build an API Gateway API with Lambda Integration</a> tutorial.</p>

<p>After that, I strongly suggest you to set up an api key and a usage plan to your api - it’s really simple, from the left menu shown the Create-API-focused-image you can do that. This is to prevent consume your API from stranger (they will be available over the Internet).</p>

<h4 id="67-fill-you-elasticsearch">6/7 Fill you Elasticsearch</h4>
<p>Ok, now it’s time to fill your elasticsearch of news. I will assume you have a dump of the news about the topic you want to sentimentanalyze in a json file called <code class="highlighter-rouge">"localDump.json"</code>. If you don’t have, you can cUrl like a PRO and dump to file. Then, I used Python to build a reasonable index of fake data - of course, you have to call your AWS Lambda function, to <em>sentiment</em> (nice, the new <em>to sentiment</em> expression, or not?!) your news but I’m poor, and I didn’t want to make DOS Attack to my own VPC. I simulate because of money lack: I’m afraid of Amazon.</p>

<figure class="highlight"><pre><code class="language-py" data-lang="py"><span class="n">polarity</span>     <span class="o">=</span> <span class="p">[</span><span class="s">"neutral"</span><span class="p">,</span> <span class="s">"neutral"</span><span class="p">,</span> <span class="s">"negative"</span><span class="p">]</span>
<span class="n">subjectivity</span> <span class="o">=</span> <span class="p">[</span><span class="s">"subjective"</span><span class="p">,</span> <span class="s">"objective"</span><span class="p">]</span>

<span class="c"># read dump</span>
<span class="n">localSource</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"localDump.json"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">))</span>

<span class="n">newsCleaned</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">newsHashing</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># local cleaning</span>
<span class="k">for</span> <span class="n">news</span> <span class="ow">in</span> <span class="n">localSource</span><span class="p">:</span>

	<span class="k">if</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="s">"description"</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newsHashing</span><span class="p">:</span>
		<span class="n">newsHashing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="s">"description"</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
		<span class="n">news</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="s">"description"</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
		<span class="n">newsCleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">news</span><span class="p">)</span>

<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">localSource</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">newsCleaned</span><span class="p">)</span>

<span class="k">for</span> <span class="n">news</span> <span class="ow">in</span> <span class="n">newsCleaned</span><span class="p">:</span>
	<span class="n">news</span><span class="p">[</span><span class="s">"text"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"document"</span>
	<span class="n">news</span><span class="p">[</span><span class="s">"polarity"</span><span class="p">]</span> <span class="o">=</span> <span class="n">polarity</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">polarity</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
	<span class="n">news</span><span class="p">[</span><span class="s">"subjectivity"</span><span class="p">]</span> <span class="o">=</span> <span class="n">subjectivity</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subjectivity</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
	<span class="n">news</span><span class="p">[</span><span class="s">"polarity_confidence"</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">news</span><span class="p">[</span><span class="s">"subjectivity_confidence"</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"elasticReady.json"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">news</span> <span class="ow">in</span> <span class="n">newsCleaned</span><span class="p">:</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"{</span><span class="se">\"</span><span class="s">index</span><span class="se">\"</span><span class="s">:{</span><span class="se">\"</span><span class="s">_id</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">"</span><span class="o">+</span><span class="n">news</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span><span class="o">+</span><span class="s">"</span><span class="se">\"</span><span class="s">}}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">news</span><span class="p">)</span><span class="o">+</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span></code></pre></figure>

<p>What does this code do? It’s very simple: it loops over the dump of the news - don’t forget that the format of each news is the one defined by the <code class="highlighter-rouge">News</code> structure in the code of the first AWS Lambda function. In the first loop, duplicates are removed, if the paginated queries - look at the <code class="highlighter-rouge">Request</code> wrapper struct in the second AWS Lambda - have been returned. Then, it simulates a Sentiment evaluation query to the second AWS Lambda and a <em>merge</em> operation over dict key (the News object), with the informations that AWS Lambda currently returns: the polarity and subjectivity of the article, with relative confidences. In the end, a file is created with an identified - hash on the article extract - to be uploaded to Elasticsearh… how? With this unique call - (of course you have to run first a docker container / ec2 instance / any-kind-of Elasticsearch node). Locally:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">curl <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-XPOST</span> <span class="s2">"localhost:9200/news/sentimented/_bulk?pretty&amp;refresh"</span> <span class="nt">--data-binary</span> <span class="s2">"@elasticReady.json"</span></code></pre></figure>

<h4 id="77-setup-your-grafana-dashboard">7/7 Setup your Grafana Dashboard</h4>
<p>And this is the most exiting part: with grafana you can setup Elasticsearch as Datasource (don’t need to explain this, simply fill the host field). Then, playing with some graphs and lucene queries / aggregation, you can create for instance an Heat map that shows how much bad or good are the feedback of the topic you are looking for. You can discover who is the top influencer in term of <em>how much it talks about the topic</em>, or simply show the number of neutral / negative feedback from highlights and setup an alarm if they reach a huge number - this is only an idea. Look at my Grafana dashboard ^^</p>

<p align="center"><img src="http://image.ibb.co/ebriG6/grafana_sentiment.png" style="width: 100%; marker-top: -10px;" /></p>

<p>Thank you everybody for reading!</p>

<div class="footnotes">
  <ol>
    <li id="fn:lambda">
      <p>You can find more information <a href="https://aws.amazon.com/lambda/?nc1=h_ls">here</a>&nbsp;<a href="#fnref:lambda" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


<div class="comments">
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'made2591';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

<hr/>


  
    <div class="post-navs row">
      
        <div class="col-md-6 post-nav">

          <h3 class="section-header">
            Older
            <span class="text-muted"> &middot; </span>
            <a href="/archive">View Archive (35)</a>
          </h3>

          <h2 class="post-title-link"><a href="/posts/network-layers-2">A journey through the network - Layer 2</a></h2>
          <h3 id="a-journey-through-the-network---layer-2">A journey through the network - Layer 2</h3>
<p>A month ago I started to wrote some posts about the network. For those who missed the previous posts, <a href="https://made2591.github.io/posts/network-layers-0">the introduction</a> and <a href="https://made2591.github.io/posts/network-layers-0">the physycal layer</a>. For the previous post I had to go into details about how some parts of the physical layer work but, by going forward with the layers, concepts belonging to separate historical standards - OSI and IP - will intertwine and this entails some troubles from a <em>logical</em> point of view. I will try, as far as possible, to keep only the basic concepts of this layer: I also remember that this layer, together with the physical layer, are - at least in part - joined together in what is called the network access layer in the TCP / IP model.
As a main source I use <a href="https://www.amazon.it/gp/product/9332518742/ref=oh_aui_detailpage_o01_s00?ie=UTF8&amp;psc=1">Computer Networks</a> and <a href="https://www.amazon.it/gp/product/9332535957/ref=oh_aui_detailpage_o02_s00?ie=UTF8&amp;psc=1">TCP/IP Illustrated</a>. In this article, I will talk about layer 1, the data link layer in the ISO / OSI stack. Enjoy the reading!</p>


        </div>
      
      

        <div class="col-md-6 post-nav">
          <h3 class="section-header">
            Newer
            
          </h3>

          <h2 class="post-title-link"><a href="/posts/quantum-computing">A Quantum Experience</a></h2>
          <h3 id="much-more-than-a-post">Much more than a post</h3>
<p>What is the quantum theory? As said by <a href="https://quantumexperience.ng.bluemix.net/">quantumexperience</a> official site by IBM, it’s <em>an elegant mathematical theory able to explain the counterintuitive behavior of subatomic particles, most notably the phenomenon of entanglement</em>. In the late twentieth century it was discovered that quantum theory applies not only to atoms and molecules, but to bits and logic operations in a computer. This realization has been bringing about a revolution in the science and technology of information processing: I decided to write some notes to better explain, from a physics-agnostic computer scientist’s point of view XD, <strong>what I understood</strong> - and it is certainly wrong - about Q until now and why I think it’s an amazing field for computer science. For skilled guys, <a href="https://github.com/made2591/quantum-notes">here</a> latex source (and <a href="https://made2591.github.io/matteo_madeddu_quantum_notes.pdf">here</a> pdf pre-compiled version) that collect my personal notes about IBM Q platform, in general the quantum-computing world. I was also invited in Verona by the Quantum Research Group of the Department of Computer Science - why? don’t know, maybe the coolest guys were sick 😂 - to talk about the platform and we had a really interesting brain-storming conversation about a quantum version of the Tris game I am working on 😎</p>


        </div>
      
    </div>
  



          <div id="footer">
<hr/>
  <div class="pull-left">
    &copy;2019.
    Built with <a href="http://jekyllrb.com/">Jekyll</a> and
    <a href="https://github.com/kirqe/autm-rb">Autm-rb</a>. Thanks to <a href="https://github.com/kirqe">kirqe</a>.
  </div>

  <div class="pull-right">
    <span class="credits pull-right social">
      
        
          <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
        
      
        
          <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
        
      
        
          <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
        
      
        
          <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
        
      
    </span>
  </div>
</div>

        </section>
    </div>
    </div>
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/javascripts/bootstrap.min.js"></script>
    <!-- Place your <script> tags here. -->

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script id="dsq-count-scr" src="//made2591-github-io.disqus.com/count.js" async></script>

<!-- disqus comment counter -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'made2591-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.type = 'text/javascript';
	    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
</script>
<!-- /disqus comment counter -->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111283556-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111283556-1');
</script>
<!-- /google analytics -->

  </body>
</html>
