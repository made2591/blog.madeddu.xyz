<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <!--<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M8WBXH7');</script>-->
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href=/public/stylesheets/bs.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/styles.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/pygment_trac.css?random=@Environment.TickCount>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="canonical" href="made2591.github.io/posts/smart-spa-shower">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <link rel="icon" type="image/x-icon"  href="/favicon.ico" />
    <title>Smart SPA Shower at home | Matteo Madeddu</title>
    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <!--<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8WBXH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrapper">
        <section>
          <div id="header">
  <h1>
    <a id="sitename" href="">Matteo Madeddu</a>
  </h1>

  <!-- Add something about you in p tag-->
  <p>Mac OS lover, Docker fan, Go explorer, Python geek, Trello addicted.</p>
  <hr/>

  <span class="credits pull-left">
    
      <a href="/">Home</a>  | 
    
      <a href="/blog">Blog</a>  | 
    
      <a href="/archive">Archive</a>  | 
    
      <a href="/about">About</a>  | 
    
      <a href="/matteo_madeddu_cv.pdf">Resume</a>  | 
    
      <a href="/quotes">Quotes</a> 
    
  </span>

  <span class="credits pull-right social">
    
      
        <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
      
    
      
        <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
      
    
      
        <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
      
    
      
        <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
      
    
  </span>


</div>


          <div class="post-title">
    <h1>Smart SPA Shower at home</h1>
    <p class="text-muted">
    


    13 Jan 2019
    
     | <i class="fa fa-comment"></i> <a class="text-muted" href="/posts/smart-spa-shower/#disqus_thread"></a>
    

    
      | <i class="fa fa-tag"></i>
      
        <a class="text-muted" href="/tags/#smart ">smart</a>,
      
        <a class="text-muted" href="/tags/#home ">home</a>,
      
        <a class="text-muted" href="/tags/#reverse-eng ">reverse-eng</a>,
      
        <a class="text-muted" href="/tags/#life ">life</a>,
      
        <a class="text-muted" href="/tags/#shower ">shower</a>,
      
        <a class="text-muted" href="/tags/#spa ">spa</a>,
      
        <a class="text-muted" href="/tags/#relax ">relax</a>
      
    
  </p>
</div>

  <h3 id="preamble">Preamble</h3>
<p>I recently bought 4 small smart bulbs - the latest one you most probably decide to buy for your smart home üòÇüòÇ I think it‚Äôs useless talk about what you can do: I will only focus on the important things.</p>

<ul>
  <li>They DON‚ÄôT need an hub;</li>
  <li>They support Alexa;</li>
  <li>They support Google Assistant;</li>
  <li>They support IFTTT;</li>
  <li>There is an app, called Smart Life (<a href="https://itunes.apple.com/us/app/smart-life-smart-living/id1115101477?mt=8">iOS</a>, <a href="https://play.google.com/store/apps/details?id=com.tuya.smartlife&amp;hl=it">Android</a>)</li>
</ul>

<p>But most important you can build your small SPA in your bathroom. If you are interested, go ahead!</p>

<p align="center"><img src="http://www.centrobenesserebluspa.com/wp-content/uploads/2016/10/Panoramica_blu-spa.jpg" style="width: 100%; marker-top: -10px;" /></p>

<p>And no, I will not transform your bathroom in the one shown in the picture: and no, that is not my bathroom unfortunately XD</p>

<h3 id="what-you-need">What you need</h3>
<p>Before going ahead with this, this is what you need:</p>

<ul>
  <li><a href="https://www.amazon.de/gp/product/B07JMR3ZZ9/ref=ppx_yo_dt_b_asin_title_o00__o00_s00?ie=UTF8&amp;psc=1">Smart Alexa Lamp, Maxcio Wifi Smart Lamp, 7W E27 RGB + W Multicoloured and Dimmable Light, Remote Control via App, Compatible with Amazon Alexa and Google Home</a> or any other product that use <a href="http://tuya.com/">Tuya</a> cloud network to communicate. This is a required condition to work with <a href="https://github.com/codetheweb/tuyapi">tuyapi</a>, a library for communicating with devices that use the Tuya cloud network. These devices are branded under many different names, but if your device works with the TuyaSmart app or port 6668 is open on your device chances are this library will work.</li>
  <li>A Google Home (mini or not) - or my <a href="https://gist.github.com/made2591/bca41ce13cced70bcb4c1712801726e3">Gist</a> with the colors mapped already for you (it should work, hopefully), otherwise you should reverse them manually by changing the color of the bulb with the Google Home app, running the server, getting the status of the lamp and save the data retrieved;</li>
  <li>A Node.js server - who doens‚Äôt have one today?! just grub a raspberry or you can even use your laptop, it will definetly not be a 24/7 shower;</li>
</ul>

<h3 id="setup-your-bulb">Setup your bulb</h3>
<p>Buy your bulb - pay attention to choose the correct socket for your lamp! - and setup your bulb with Smart Life. Then, sync your device with google home by asking him to ‚Äúsync device‚Äù. I suggest to not setup rooms inside the app to avoid collision with rooms you can easily and more efficiently setup in your Google home app.</p>

<h3 id="the-id-key-and-ip">The ID, KEY and IP</h3>
<p>Before setup your node server, you need to discover some hidden information about your bulb. To retrieve needed ID and KEY of your bulb, just follow the instruction given <a href="https://github.com/codetheweb/tuyapi/blob/master/docs/SETUP.md">there</a>. Everywhere it is suggested to fix an IP to your bulb.</p>

<h3 id="how-to-discover-the-colors">How to discover the colors</h3>
<p>I retrieved them by looking at the change of status after every click over the colors available in the Google Home application</p>
<p align="center"><img src="https://i.imgur.com/3mGarQf.jpg" style="width: 30%; marker-top: -10px;" /></p>

<p>The White color looks like that:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="s2">"1"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"2"</span><span class="p">:</span><span class="s2">"white"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"3"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="w">
    </span><span class="s2">"5"</span><span class="p">:</span><span class="s2">"fffafa000005ff"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"6"</span><span class="p">:</span><span class="s2">"00ff0000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"7"</span><span class="p">:</span><span class="s2">"ffff500100ff00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"8"</span><span class="p">:</span><span class="s2">"ffff8003ff000000ff000000ff000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"9"</span><span class="p">:</span><span class="s2">"ffff5001ff0000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"10"</span><span class="p">:</span><span class="s2">"ffff0505ff000000ff00ffff00ff00ff0000ff000000"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>The Color looks like that:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="s2">"1"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"2"</span><span class="p">:</span><span class="s2">"colour"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"3"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="w">
    </span><span class="s2">"4"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="w">
    </span><span class="s2">"5"</span><span class="p">:</span><span class="s2">"f8f8ff00f007ff"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"6"</span><span class="p">:</span><span class="s2">"00ff0000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"7"</span><span class="p">:</span><span class="s2">"ffff500100ff00"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"8"</span><span class="p">:</span><span class="s2">"ffff8003ff000000ff000000ff000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"9"</span><span class="p">:</span><span class="s2">"ffff5001ff0000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"10"</span><span class="p">:</span><span class="s2">"ffff0505ff000000ff00ffff00ff00ff0000ff000000"</span><span class="w">
</span><span class="p">},</span></code></pre></figure>

<p>If you need to discover yours, or want to experiment with voltage etc, you can do it by changing the <a href="https://gist.github.com/made2591/bca41ce13cced70bcb4c1712801726e3">JSON</a> just in case.</p>

<h3 id="wrap-everything-in-a-loop">Wrap everything in a loop</h3>
<p>And now my stupid and bad written code to give your bathroom some colors in a loop of 3 seconds over the colors file provided above (<a href="https://gist.github.com/made2591/bca41ce13cced70bcb4c1712801726e3">Gist</a> just in case)</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">TuyAPI</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tuyapi'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sleep</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'sleep'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">device</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TuyAPI</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s2">"&lt;YOUR_BULB_ID&gt;"</span><span class="p">,</span>
  <span class="na">key</span><span class="p">:</span> <span class="s2">"&lt;YOUR_BULB_KEY&gt;"</span><span class="p">,</span>
  <span class="na">ip</span><span class="p">:</span> <span class="s2">"&lt;YOUR_IP_KEY&gt;"</span><span class="p">,</span>
  <span class="na">persistentConnection</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>

<span class="nx">device</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connected'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Connected to device.'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">device</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'disconnected'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Disconnected from device.'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">device</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Data from device:'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">device</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error: '</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">device</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">colours</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">'./colours.json'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">));</span>

<span class="kd">function</span> <span class="nx">applyColour</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">device</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span>
    <span class="na">multiple</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'1'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s1">'2'</span><span class="p">:</span> <span class="nx">info</span><span class="p">[</span><span class="s2">"2"</span><span class="p">],</span>
      <span class="s1">'5'</span><span class="p">:</span> <span class="nx">info</span><span class="p">[</span><span class="s2">"5"</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">funcs</span> <span class="o">=</span> <span class="nx">colours</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">info</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">applyColour</span><span class="p">(</span><span class="nx">info</span><span class="p">))</span>

<span class="kd">const</span> <span class="nx">promiseSerial</span> <span class="o">=</span> <span class="nx">funcs</span> <span class="o">=&gt;</span>
  <span class="nx">funcs</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">promise</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">concat</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span> <span class="nx">sleep</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span>
    <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([]))</span>

<span class="nx">promiseSerial</span><span class="p">(</span><span class="nx">funcs</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">))</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">device</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span> <span class="p">},</span> <span class="mi">1000000</span><span class="p">);</span></code></pre></figure>

<h3 id="one-more-thing">One more thing</h3>
<p>To have a more relaxing experience you can even listen to <a href="spotify:artist:3yQUKaHkSwdGxlk8LxN5iu">The Relaxing Sounds of Swedish Nature</a> with your Google Home or any other device you want!</p>

<p>Thank you everybody for reading and have a good shower!!</p>


<div class="comments">
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'made2591';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

<hr/>


  
    <div class="post-navs row">
      
        <div class="col-md-6 post-nav">

          <h3 class="section-header">
            Older
            <span class="text-muted"> &middot; </span>
            <a href="/archive">View Archive (35)</a>
          </h3>

          <h2 class="post-title-link"><a href="/posts/machine-learning">Machine Learning is useless</a></h2>
          <h3 id="preamble">Preamble</h3>
<p>I would like to say ‚Äúrecently‚Äù, but actually is almost a few years I heard - and I‚Äôm still hearing a lot about Machine Learning and I didn‚Äôt want to believe it until now - believe me, I truly didn‚Äôt want to believe it - but yes here we are Machine Learning ufficially replace Big Data as buzzy word of the this past years, most problably will be still the word of the next year and I could not be more sad, frustrated, and worried about. Please haters don‚Äôt hate me, Internet don‚Äôt misunderstand me, companies don‚Äôt hire me, but first of all - please - don‚Äôt teach anything to your machines before finishing this post (!) ü§ì because they never learnt anything until now and they always felt good about so please - keep them simple operating system as they are, or at least talk with them before enrolled them in any advanced analytics course.</p>


        </div>
      
      

        <div class="col-md-6 post-nav">
          <h3 class="section-header">
            Newer
            
          </h3>

          <h2 class="post-title-link"><a href="/posts/golang-turing-machine">A Golang Turing machine library</a></h2>
          <h3 id="preamble">Preamble</h3>
<p>In 1962, Hungarian mathematician Tibor Rad√≥ introduced the Busy Beaver competition for Turing machines: in a class of machines, find one which halts after the greatest number of steps when started on the empty input. Even if it could seem trivial, the Busy Beaver competition has implications in computability theory, the halting problem, and complexity theory.</p>


        </div>
      
    </div>
  



          <div id="footer">
<hr/>
  <div class="pull-left">
    &copy;2019.
    Built with <a href="http://jekyllrb.com/">Jekyll</a> and
    <a href="https://github.com/kirqe/autm-rb">Autm-rb</a>. Thanks to <a href="https://github.com/kirqe">kirqe</a>.
  </div>

  <div class="pull-right">
    <span class="credits pull-right social">
      
        
          <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
        
      
        
          <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
        
      
        
          <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
        
      
        
          <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
        
      
    </span>
  </div>
</div>

        </section>
    </div>
    </div>
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/javascripts/bootstrap.min.js"></script>
    <!-- Place your <script> tags here. -->

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script id="dsq-count-scr" src="//made2591-github-io.disqus.com/count.js" async></script>

<!-- disqus comment counter -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'made2591-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.type = 'text/javascript';
	    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
</script>
<!-- /disqus comment counter -->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111283556-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111283556-1');
</script>
<!-- /google analytics -->

  </body>
</html>
