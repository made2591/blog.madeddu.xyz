<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <!--<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M8WBXH7');</script>-->
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href=/public/stylesheets/bs.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/styles.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/pygment_trac.css?random=@Environment.TickCount>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="canonical" href="made2591.github.io/posts/aws-step-functions">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <link rel="icon" type="image/x-icon"  href="/favicon.ico" />
    <title>Node.js, DynamoDB, and AWS Step Functions to collect <em>sentimented</em> movie reviews | Matteo Madeddu</title>
    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <!--<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8WBXH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrapper">
        <section>
          <div id="header">
  <h1>
    <a id="sitename" href="">Matteo Madeddu</a>
  </h1>

  <!-- Add something about you in p tag-->
  <p>Mac OS lover, Docker fan, Go explorer, Python geek, Trello addicted.</p>
  <hr/>

  <span class="credits pull-left">
    
      <a href="/">Home</a>  | 
    
      <a href="/blog">Blog</a>  | 
    
      <a href="/archive">Archive</a>  | 
    
      <a href="/about">About</a>  | 
    
      <a href="/matteo_madeddu_cv.pdf">Resume</a>  | 
    
      <a href="/quotes">Quotes</a> 
    
  </span>

  <span class="credits pull-right social">
    
      
        <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
      
    
      
        <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
      
    
      
        <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
      
    
      
        <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
      
    
  </span>


</div>


          <div class="post-title">
    <h1>Node.js, DynamoDB, and AWS Step Functions to collect <em>sentimented</em> movie reviews</h1>
    <p class="text-muted">
    


    05 Mar 2018
    
     | <i class="fa fa-comment"></i> <a class="text-muted" href="/posts/aws-step-functions/#disqus_thread"></a>
    

    
      | <i class="fa fa-tag"></i>
      
        <a class="text-muted" href="/tags/#coding ">coding</a>,
      
        <a class="text-muted" href="/tags/#aws ">aws</a>,
      
        <a class="text-muted" href="/tags/#tmdb ">tmdb</a>,
      
        <a class="text-muted" href="/tags/#news ">news</a>,
      
        <a class="text-muted" href="/tags/#step ">step</a>,
      
        <a class="text-muted" href="/tags/#functions ">functions</a>,
      
        <a class="text-muted" href="/tags/#lambda ">lambda</a>,
      
        <a class="text-muted" href="/tags/#serverless ">serverless</a>,
      
        <a class="text-muted" href="/tags/#sentiment ">sentiment</a>,
      
        <a class="text-muted" href="/tags/#analysis ">analysis</a>
      
    
  </p>
</div>

  <h3 id="introduction">Introduction</h3>
<p>Recently I worked with AWS Lambda and API Gateway to extend my set of personal APIs and collect information from several sources. I wrote an article on that (if you want to <a href="https://made2591.github.io/posts/aws-lambda">have a look</a>). In this article I will talk about the AWS Step Functions service that enable create finite states machines to easy coordinate the components of distributed applications and microservices using visual workflows. Why AWS Step Functions? Because they let me create a tool to gather movie titles in teather, search for reviews about each of them and make a basic sentiment analysis over the review to help me decide what’s worth watching at teather and what’s worth waiting for on Netflix :D
More in general, with AWS Step Functions, you can build applications made of individual components that each perform a discrete function: this lets you scale and change applications quickly. Step Functions is a reliable way to coordinate components and step through the functions of your application. They provides a graphical console to arrange and visualize the components of your application as a series of steps. This makes it simple to build and run multistep applications. Step Functions automatically triggers and tracks each step, and retries when there are errors, so your application executes in order and as expected. Step Functions logs the state of each step, so when things do go wrong, you can diagnose and debug problems quickly.</p>

<p align="center"><img src="http://image.ibb.co/m3LxJS/aws_step_functions.png" style="width: 100%; marker-top: -10px;" /></p>

<h3 id="ingredients">Ingredients</h3>
<p>For this article, you will need the following:</p>
<ul>
  <li><a href="http://aws.amazon.com">AWS account</a> (free tier it’s ok, but API Gateway is not included);</li>
  <li><a href="http://newsapi.org">Newsapi</a> account to gather news from several sources (the free tier it’s ok for our purpose);</li>
  <li><a href="http://aylien.com">Aylien</a> account to do some sentiment analysis (the free tier it’s ok for our purpose);</li>
  <li><a href="https://aws.amazon.com/en/lambda/">AWS Lambda</a> to wrap services around the world to ghater and process data;</li>
  <li><a href="https://aws.amazon.com/en/dynamodb/">DynamoDB</a> to both optmize requests and persist processed data;</li>
  <li><a href="https://aws.amazon.com/en/step-functions/">AWS Step Functions</a>, of course, to create the workflow, orchestrate lambdas and work on the data flow;</li>
</ul>

<h3 id="considerations">Considerations</h3>
<p><strong>First point</strong>: as I already said in a preview post on AWS Services, there are a lot of quite simple steps. I recommend you to pay a lot of attention with AWS. You always have to know exactly what are you doing, to avoid surprise in billing in the end of the month. Fortunately, there are a lot of documentations on Amazon official site, so you only have to read them.</p>

<p><strong>Second point</strong>: please pay attention to the number of steps and infinity loop when you are working with AWS Step Functions, Iteration and Parallel Workflow. The following workflow is prepared to be a mix of some of the features exposed by the AWS service: despite it provides some example of <em>how effectively you can increase the efficience of a step functions workflow</em>, is not intended to be efficient, nor the smartest way to implement the workflow. The first 4000 transactions from one state to another - don’t be scared by the output log of the workflow! It shows quite three/four times the number of effective transactions because it show you the scheduled state, the start state, the output state, etc. After that, the cost is billed in terms of thousands, something like 0.025 dollars for 1000 thousands (more <a href="https://aws.amazon.com/en/step-functions/pricing/">here</a>).</p>

<h4 id="1-2-3-4-steps">1-2-3-4 Steps</h4>
<p>The first four steps are equal to the one described <a href="https://made2591.github.io/posts/aws-lambda">here</a>. The only things I added is the HasElements bool <code class="highlighter-rouge">json:"has_elements"</code> to the NewsApiResponse Object (see next step).</p>

<h4 id="5---build-moviedb-collector-over-aws-lambda">5 - Build MovieDB collector over AWS Lambda</h4>
<p>Lambda currently supports different languages: C#, Java, Node.js, Python and now Go. I wrote a GoLang wrapper around the API exposed by TheMovieDB <a href="http://themoviedb.org">here</a>: I am working on a front-end written in Angular to show the elements gathered by this workflow, so I created a parametric AWS Lambda to wrap (almost) all the routes exposed by TheMovieDB APIs and be able to fill my front-end in the future. AWS Lambda ready GoLang file is a single <code class="highlighter-rouge">.go</code> file with a function, the <code class="highlighter-rouge">handler</code> and a <code class="highlighter-rouge">main</code> function to link the handler function to the lambda. And that’s all. The only dependencies you need to install, if you want to run your lambda locally, is the <code class="highlighter-rouge">aws-lambda-go</code> sdk provided by Amazon and available on Github.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">go get github.com/aws/aws-lambda-go/lambda</code></pre></figure>

<p>The entire TheMovieDB Go Wrapper ready to build for AWS Lambda is available <a href="https://gist.github.com/made2591/f2b8280035d0d770269f8695f54091c8.js">in this gist</a>. It follows a preview:</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"os"</span><span class="x">
	</span><span class="s">"fmt"</span><span class="x">
	</span><span class="s">"errors"</span><span class="x">
	</span><span class="s">"strings"</span><span class="x">
	</span><span class="s">"net/http"</span><span class="x">
	</span><span class="s">"encoding/json"</span><span class="x">
	</span><span class="s">"github.com/aws/aws-lambda-go/lambda"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="n">API_KEY</span><span class="x">      </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"API_KEY"</span><span class="p">)</span><span class="x">
	</span><span class="n">API_BASE_URL</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"API_BASE_URL"</span><span class="p">)</span><span class="x">
	</span><span class="n">AWS_API_KEY</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AWS_API_KEY"</span><span class="p">)</span><span class="x">
	</span><span class="n">ErrorBackend</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"Something went wrong"</span><span class="p">)</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Request</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Url</span><span class="x"> 					</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"api_url"`</span><span class="x">
	</span><span class="n">AwsApiGatewayKey</span><span class="x"> 		</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"aws_api_gateway_key"`</span><span class="x">

	</span><span class="n">ExternalID</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"external_id"`</span><span class="x">
	</span><span class="n">ExternalSource</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"external_source"`</span><span class="x">

	</span><span class="n">Query</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x">		</span><span class="s">`json:"query"`</span><span class="x">

	</span><span class="n">ApiKey</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"api_key"`</span><span class="x">
	</span><span class="n">Language</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"language"`</span><span class="x">
	</span><span class="n">Region</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"region"`</span><span class="x">
	</span><span class="n">SortBy</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"sort_by"`</span><span class="x">
	</span><span class="n">CertificationCountry</span><span class="x"> 	</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"certification_country"`</span><span class="x">
	</span><span class="n">Certification</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"certification"`</span><span class="x">
	</span><span class="n">CertificationLTE</span><span class="x"> 		</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"certification.lte"`</span><span class="x">
	</span><span class="n">IncludeAdult</span><span class="x">			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"include_adult"`</span><span class="x">
	</span><span class="n">IncludeVideo</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"include_video"`</span><span class="x">
	</span><span class="n">Page</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"page"`</span><span class="x">
	</span><span class="n">PrimaryReleaseYear</span><span class="x"> 		</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"primary_release_year"`</span><span class="x">
	</span><span class="n">PrimaryReleaseDateGTE</span><span class="x"> 	</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"primary_release_date.gte"`</span><span class="x">
	</span><span class="n">PrimaryReleaseDateLTE</span><span class="x">	</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"primary_release_date.lte"`</span><span class="x">
	</span><span class="n">ReleaseDateGTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"release_date.gte"`</span><span class="x">
	</span><span class="n">ReleaseDateLTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"release_date.lte"`</span><span class="x">
	</span><span class="n">VoteCountGTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"vote_count.gte"`</span><span class="x">
	</span><span class="n">VoteCountLTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"vote_count.lte"`</span><span class="x">
	</span><span class="n">VoteAverageGTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"vote_average.gte"`</span><span class="x">
	</span><span class="n">VoteAverageLTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"vote_average.lte"`</span><span class="x">
	</span><span class="n">WithCast</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_cast"`</span><span class="x">
	</span><span class="n">WithCrew</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_crew"`</span><span class="x">
	</span><span class="n">WithCompanies</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_companies"`</span><span class="x">
	</span><span class="n">WithGenres</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_genres"`</span><span class="x">
	</span><span class="n">WithKeywords</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_keywords"`</span><span class="x">
	</span><span class="n">WithPeople</span><span class="x"> 				</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_people"`</span><span class="x">
	</span><span class="n">Year</span><span class="x"> 					</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"year"`</span><span class="x">
	</span><span class="n">WithoutGenres</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"without_genres"`</span><span class="x">
	</span><span class="n">WithRuntimeGTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_runtime.gte"`</span><span class="x">
	</span><span class="n">WithRuntimeLTE</span><span class="x"> 			</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_runtime.lte"`</span><span class="x">
	</span><span class="n">WithReleaseType</span><span class="x"> 		</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_release_type"`</span><span class="x">
	</span><span class="n">WithOriginalLanguage</span><span class="x"> 	</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"with_original_language"`</span><span class="x">
	</span><span class="n">WithoutKeywords</span><span class="x"> 		</span><span class="o">*</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"without_keywords"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Page</span><span class="x"> 					</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"page"`</span><span class="x">
	</span><span class="n">Results</span><span class="x"> 				</span><span class="p">[]</span><span class="n">Movie</span><span class="x"> </span><span class="s">`json:"results"`</span><span class="x">
	</span><span class="n">TotalResults</span><span class="x">			</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"total_results"`</span><span class="x">
	</span><span class="n">TotalPages</span><span class="x"> 				</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"total_pages"`</span><span class="x">
	</span><span class="n">HasElements</span><span class="x"> 			</span><span class="kt">bool</span><span class="x">    </span><span class="s">`json:"has_elements"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Movie</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">Cover</span><span class="x"> 					</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"poster_path"`</span><span class="x">
	</span><span class="n">PosterPath</span><span class="x"> 				</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"poster_path"`</span><span class="x">
	</span><span class="n">Adult</span><span class="x"> 					</span><span class="kt">bool</span><span class="x"> 	</span><span class="s">`json:"adult"`</span><span class="x">
	</span><span class="n">Overview</span><span class="x"> 				</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"overview"`</span><span class="x">
	</span><span class="n">ReleaseDate</span><span class="x"> 			</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"release_date"`</span><span class="x">
	</span><span class="n">GenreIDs</span><span class="x"> 				</span><span class="p">[]</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"genre_ids"`</span><span class="x">
	</span><span class="n">ID</span><span class="x"> 						</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"id"`</span><span class="x">
	</span><span class="n">OriginalTitle</span><span class="x"> 			</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"original_title"`</span><span class="x">
	</span><span class="n">OriginalLanguage</span><span class="x"> 		</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"original_language"`</span><span class="x">
	</span><span class="n">Title</span><span class="x"> 					</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"title"`</span><span class="x">
	</span><span class="n">BackdropPath</span><span class="x"> 			</span><span class="kt">string</span><span class="x"> 	</span><span class="s">`json:"backdrop_path"`</span><span class="x">
	</span><span class="n">Popularity</span><span class="x"> 				</span><span class="kt">float32</span><span class="x"> </span><span class="s">`json:"popularity"`</span><span class="x">
	</span><span class="n">VoteCount</span><span class="x"> 				</span><span class="kt">int</span><span class="x"> 	</span><span class="s">`json:"vote_count"`</span><span class="x">
	</span><span class="n">Video</span><span class="x"> 					</span><span class="kt">bool</span><span class="x"> 	</span><span class="s">`json:"video"`</span><span class="x">
	</span><span class="n">VoteAverage</span><span class="x"> 			</span><span class="kt">float32</span><span class="x"> </span><span class="s">`json:"vote_average"`</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">Handler</span><span class="p">(</span><span class="n">request</span><span class="x"> </span><span class="n">Request</span><span class="p">)</span><span class="x"> </span><span class="p">(</span><span class="n">MovieDBResponse</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">

	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Url</span><span class="x"> </span><span class="o">==</span><span class="x"> </span><span class="s">""</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"Missing one of the required parameters: 'api_url'"</span><span class="p">)</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="n">url</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s%s?api_key=%s"</span><span class="p">,</span><span class="x"> </span><span class="n">API_BASE_URL</span><span class="p">,</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">Url</span><span class="p">,</span><span class="x"> </span><span class="n">API_KEY</span><span class="p">)</span><span class="x">

	</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="o">&amp;</span><span class="n">http</span><span class="o">.</span><span class="n">Client</span><span class="p">{}</span><span class="x">

	</span><span class="n">req</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span><span class="x"> </span><span class="n">url</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="p">)</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">CertificationCountry</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">q</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">q</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"certification_country"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">CertificationCountry</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">q</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="k">if</span><span class="x"> </span><span class="n">request</span><span class="o">.</span><span class="n">VoteAverageLTE</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">q</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="x">
		</span><span class="n">q</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"vote_average.lte"</span><span class="p">,</span><span class="x"> </span><span class="o">*</span><span class="n">request</span><span class="o">.</span><span class="n">VoteAverageLTE</span><span class="p">)</span><span class="x">
		</span><span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">RawQuery</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">q</span><span class="o">.</span><span class="n">Encode</span><span class="p">()</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="o">...</span><span class="c">// the complete file here https://gist.github.com/made2591/f2b8280035d0d770269f8695f54091c8.js</span><span class="x">

	</span><span class="n">resp</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="k">defer</span><span class="x"> </span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

	</span><span class="k">var</span><span class="x"> </span><span class="n">data</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">MovieDBResponse</span><span class="p">{},</span><span class="x"> </span><span class="n">ErrorBackend</span><span class="x">
	</span><span class="p">}</span><span class="x">
	</span><span class="n">data</span><span class="o">.</span><span class="n">HasElements</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="no">false</span><span class="p">;</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Results</span><span class="p">)</span><span class="x"> </span><span class="o">&gt;</span><span class="x"> </span><span class="m">0</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">data</span><span class="o">.</span><span class="n">HasElements</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="no">true</span><span class="p">;</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="k">return</span><span class="x"> </span><span class="n">data</span><span class="p">,</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">lambda</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">Handler</span><span class="p">)</span><span class="x">
</span><span class="p">}</span></code></pre></figure>

<p><strong>NOTE</strong>: the <code class="highlighter-rouge">HasElements</code> property is an important field of the MovieDBResponse because it will let us implement an iteration in the AWS Step Function workflow.</p>

<p>I also found <a href="https://github.com/lambci/docker-lambda">this</a> beautiful docker image that let you test your lambda (and support also GoLang) with a single docker run. You can pass the parameters as a string (payload requests), as shown in the method above: of course, you first have to compile your lambda for linux.</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-o</span> TMDB TMDB.go

docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="nv">$PWD</span>:/var/task lambci/lambda:go1.x TMDB <span class="s1">'{"url": "/discover/movie"}'</span></code></pre></figure>

<p>To upload your Lambda in AWS, in the creation steps specify you want to upload a Go 1.x Lambda, then zip your build (in the example, <code class="highlighter-rouge">TMDB</code>)</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">zip TMDB.zip TMDB</code></pre></figure>

<p>and upload from an S3 bucket or manually.</p>

<p align="center"><img src="http://image.ibb.co/mJqX9R/aws_lambda_2.png" style="width: 100%; marker-top: -10px;" /></p>

<h4 id="6---build-an-aws-step-functions-workflow">6 - Build an AWS Step Functions Workflow</h4>
<p>A finite state machine is an automata with really simple rule. Almost each states are Tasks that call AWS Lambda functions and are directly linked with one or more states. You provide an input to the workflow, the first(s) lambda are invoked, then the output of the execution is passed as the input to the next states (and eventually AWS Lambda(s) invoked by them).</p>

<p>The entire workflow of a step function is described by a JSON file and can be written directly in a console available in the AWS Step Function web page. You can view a preview of the worflow in the right part of the screen while you’re defining it.</p>

<p align="center"><img src="http://image.ibb.co/dE5QNn/workflow_edit.png" style="width: 100%; marker-top: -10px;" /></p>

<p>The final workflow for our scope will look like the image below:</p>

<p align="center"><img src="http://image.ibb.co/nAk0Nn/workflow_empty.png" alt="perceptron" style="width: 100%; marker-top: -10px;" /></p>

<p>The respective workflow JSON description looks like the following code:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"Comment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A movie evaluator based on sentiment analysis."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GetMoviesInTheather"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"GetMoviesInTheather"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:TMDB"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PrepareStructures"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"PrepareStructures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:MoviesTitleIterator"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">    
    </span><span class="s2">"MovieIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Choice"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Choices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"Variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$.movies.has_elements"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"BooleanEquals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieInformationExtraction"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Done"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"MovieInformationExtraction"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parallel"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Branches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PersistMovie"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"PersistMovie"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:PersistMovie"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BreakingNews"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"BreakingNews"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:BreakingNews"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NewsIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"NewsIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Choice"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Choices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"Variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$[1].has_elements"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"BooleanEquals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PrepareSentimentRequest"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ToMovieIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"ToMovieIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:ToMovieIterator"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"PrepareSentimentRequest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:PrepareSentimentRequest"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SentimentController"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"SentimentController"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parallel"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Branches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AylienSentiment"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"AylienSentiment"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"InputPath"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"$[1].aylienQuery"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:AylienSentiment"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Retry"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="s2">"ErrorEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"States.ALL"</span><span class="w"> </span><span class="p">],</span><span class="w">
                  </span><span class="s2">"IntervalSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"MaxAttempts"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"BackoffRate"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="w">
               </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
              </span><span class="s2">"Catch"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="s2">"ErrorEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"States.ALL"</span><span class="w"> </span><span class="p">],</span><span class="w">
                  </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FallBack"</span><span class="w">
               </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"FallBack"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
               </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pass"</span><span class="p">,</span><span class="w">
               </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NoOp"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"NoOp"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pass"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PersistNews"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"PersistNews"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:PersistNews"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NewsIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"Done"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pass"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>PLEASE DON’T PANIC!!!! :D</p>

<p>As explained in the introduction, the workflow is a collection of states linked togheter. A state is defined by different properties:</p>

<h5 id="common-state-fields">Common State Fields</h5>
<ul>
  <li><strong>Type (Required)</strong>: the states could be defined of different types. The most important keyword-types for state for this how-to are three: <code class="highlighter-rouge">Task</code>, <code class="highlighter-rouge">Parallel</code>, <code class="highlighter-rouge">Choice</code>.</li>
  <li><strong>Next</strong>: the name of the next state that will be run when the current state finishes. Some state types, such as Choice, allow multiple transition states.</li>
  <li><strong>End</strong>: designates this state as a terminal state (it ends the execution) if set to true. There can be any number of terminal states per state machine. Only one of Next or End can be used in a state. Some state types, such as Choice, do not support or use the End field.</li>
  <li><strong>Comment (Optional)</strong>: holds a human-readable description of the state.</li>
  <li><strong>InputPath (Optional)</strong>: a path that selects a portion of the state’s input to be passed to the state’s task for processing. If omitted, it has the value $ which designates the entire input. For more information, see Input and Output Processing).</li>
  <li><strong>OutputPath (Optional)</strong>: a path that selects a portion of the state’s input to be passed to the state’s output. If omitted, it has the value $ which designates the entire input. For more information, see Input and Output Processing.</li>
</ul>

<h5 id="task">Task</h5>
<p>A Task state (“Type”: “Task”) represents a single unit of work performed by a state machine. In addition to the common state fields, Task states have the following fields:</p>
<ul>
  <li>Resource (Required): a URI, especially an Amazon Resource Name (ARN) that uniquely identifies the specific task to execute;</li>
  <li>ResultPath (Optional): specifies where (in the input) to place the results of executing the task specified in Resource. The input is then filtered as prescribed by the OutputPath field (if present) before being used as the state’s output. For more information, see path;</li>
  <li>Retry (Optional): an array of objects, called Retriers, that define a retry policy in case the state encounters runtime errors. For more information, see Retrying After an Error;</li>
  <li>Catch (Optional)<sup id="fnref:catch"><a href="#fn:catch" class="footnote">1</a></sup>, TimeoutSeconds (Optional), HeartbeatSeconds (Optional): for more details about these fields, look at the official AWS docs;</li>
</ul>

<p>A Task state must set either the End field to true if the state ends the execution, or must provide a state in the Next field that will be run upon completion of the Task state. For instance, the state <code class="highlighter-rouge">GetMoviesInTheather</code></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">   
	</span><span class="err">...</span><span class="w">
    </span><span class="s2">"GetMoviesInTheather"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:TMDB"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PrepareStructures"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"PrepareStructures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:MoviesTitleIterator"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>calls the AWS Lambda function TMDB defined above and put the entire output in ResultPath: the <code class="highlighter-rouge">$</code> in subsequent states will refer to the output generated by the corresponding call. <code class="highlighter-rouge">PrepareStructures</code> is a state that calls a Node.js AWS Lambda Function that operate over the input to create structure ready to be parsed by the <code class="highlighter-rouge">MovieIterator</code> (a generic step for the iterator).</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">movies</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">news</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">movies</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">;</span>
        <span class="nx">news</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">movies</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">structures</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"movies"</span> <span class="p">:</span> <span class="nx">movies</span><span class="p">,</span> <span class="s2">"news"</span> <span class="p">:</span> <span class="nx">news</span><span class="p">,</span> <span class="s2">"sentiment"</span> <span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>

    <span class="c1">// Array still has elements:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Creating query news for movie: '</span> <span class="o">+</span> <span class="nx">structures</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">movie_id</span> <span class="o">=</span> <span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">q</span> <span class="o">=</span> <span class="nx">structures</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">original_title</span><span class="p">;</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">sortBy</span> <span class="o">=</span> <span class="s2">"relevancy"</span><span class="p">;</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">structures</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Log array elements (for demonstration purpose)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Array has more elements: '</span> <span class="o">+</span> <span class="nx">structures</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span><span class="p">);</span>
    
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">structures</span><span class="p">);</span>
<span class="p">};</span></code></pre></figure>

<p>The code in the lambda simply create a dict struct if passed input is an Array - this happens after further executions. It also preparare the input to be used by a previous AWS Lambda - the <code class="highlighter-rouge">BreakingNews</code> that expected a dict of three parameters as input, to look for 10 most relevant news for the first movie of the list. To explain what happens in the next state, the <code class="highlighter-rouge">MovieIterator</code>, I need to talk first about the Choice type.</p>

<h5 id="choice">Choice</h5>
<p>A Choice state (“Type”: “Choice”) adds branching logic to a state machine. In addition to the common state fields, Choice states introduce the following additional fields:</p>
<ul>
  <li>Choices (Required): this is an array of Choice Rules that determines which state the state machine transitions to next;</li>
  <li>Default (Optional, Recommended): the name of the state to transition to if none of the transitions in Choices is taken;</li>
</ul>

<p>Choice states <strong>do not support the End field</strong>. In addition, they use Next only inside their Choices field. Choice type is particularly interesting when you need to process large files. Lambda functions have a couple of limitations namely memory and a 5 minute timeout. If you have some operation you need to perform on a very large dataset it may not be possible to complete this operation in a single execution of a lambda function. There are several ways to solve this problem: one of them is to use a Choice to create an Iterator pattern, loop over results provided by a first call to a AWS Lambda function - in this case <code class="highlighter-rouge">PrepareStructures</code> (that wrapps the input of the <code class="highlighter-rouge">GetMoviesInTheather</code>). Let’s have a look at the state below:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> 
	</span><span class="err">...</span><span class="w">
	</span><span class="s2">"PrepareStructures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
		</span><span class="err">...</span><span class="w"> 
		</span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieIterator"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="s2">"MovieIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Choice"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Choices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"Variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$.movies.has_elements"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"BooleanEquals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieInformationExtraction"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Done"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>The state is invoked after the end of execution of the AWS Lambda function invoked by <code class="highlighter-rouge">PrepareStructures</code> (I will return later on the first input passed to the workflow to start the entire process). The state checks if the property movies of the input field has a boolean field <code class="highlighter-rouge">has_elements</code> - remember the MovieDBResponse property? - is equal to true. This implies that the input provided to the state <code class="highlighter-rouge">MovieIterator</code> has to provide always a dict object with a movies properties. I will return later on this.</p>

<p>Thus, the <code class="highlighter-rouge">MovieInformationExtraction</code> starts: let’s introduce first the Parallel type states.</p>

<h5 id="parallel">Parallel</h5>
<p>The Parallel state (“Type”: “Parallel”) can be used to create parallel branches of execution in your state machine. In addition to the common state fields, Parallel states introduce these additional fields:</p>
<ul>
  <li>Branches (Required): an array of objects that specify state machines to execute in parallel. Each such state machine object must have fields named States and StartAt whose meanings are exactly like those in the top level of a state machine;</li>
  <li>ResultPath (Optional): specifies where (in the input) to place the output of the branches. The input is then filtered as prescribed by the OutputPath field (if present) before being used as the state’s output. For more information, see Input and Output Processing.</li>
  <li>Retry and catch are optional;</li>
</ul>

<p>A Parallel state causes AWS Step Functions to execute each branch, starting with the state named in that branch’s StartAt field, as concurrently as possible, and <strong>wait until all branches terminate</strong> (reach a terminal state) before processing the Parallel state’s Next field.</p>

<p><strong>NOTE</strong>: each branch must be self-contained. A state in one branch of a Parallel state <strong>must not have</strong> a Next field that targets a field outside of that branch, nor can any other state outside the branch transition into that branch.</p>

<h5 id="parallel-state-output">Parallel State Output</h5>
<p>A Parallel state provides each branch with a copy of its own input data (subject to modification by the InputPath field). It generates output <strong>which is an array with one element for each branch containing the output from that branch</strong>. There is no requirement that all elements be of the same type. The output array can be inserted into the input data (and the whole sent as the Parallel state’s output) by using a ResultPath field in the usual way (see Input and Output Processing in the official AWS Docs). Let’s have a look at the <code class="highlighter-rouge">MovieInformationExtraction</code> code:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> 
    </span><span class="err">...</span><span class="w">
    </span><span class="s2">"MovieInformationExtraction"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parallel"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Branches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PersistMovie"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"PersistMovie"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:PersistMovie"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"StartAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BreakingNews"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"States"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"BreakingNews"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:BreakingNews"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"End"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NewsIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">},</span></code></pre></figure>

<p>This state both call a Node.js AWS Lambda to persist the first movie in the data received from the <code class="highlighter-rouge">MovieIterator</code> step and looks for news about the movie. The input is the output provided by the <code class="highlighter-rouge">PrepareStructures</code>: in fact the MovieIterator does NOT modify the input it receives.</p>

<h5 id="persistmovie-movie">PersistMovie movie</h5>
<p>The <code class="highlighter-rouge">PersistMovie</code> calls an AWS Lambda function written in Node.js to persit the movie to a DynamoDB table previously created - it’s really simply, you can start from <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SampleData.CreateTables.html">here</a> and read more about how DynamoDB works in the official AWS Docs.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'aws-sdk'</span><span class="p">);</span>
<span class="nx">AWS</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="na">region</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGION</span> <span class="p">});</span>
<span class="kd">const</span> <span class="nx">dynamodb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"request: "</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"PUT begins"</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">insertion</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">insertion</span><span class="p">.</span><span class="nx">add_date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()).</span><span class="nx">toString</span><span class="p">();</span>
        
        <span class="kd">let</span> <span class="nx">movie</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">TableName</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MOVIES_TABLE</span><span class="p">,</span>
            <span class="na">Item</span><span class="p">:</span> <span class="nx">insertion</span>
        <span class="p">};</span>
    
        <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">movie</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"movie"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> 
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"dynamodb err: "</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"dynamodb data: "</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"PUT end"</span><span class="p">);</span>
        <span class="p">});</span>
    
        <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">movie_id</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">q</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">original_title</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">sortBy</span> <span class="o">=</span> <span class="s2">"relevancy"</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    
<span class="p">};</span></code></pre></figure>

<p>The Lambda put the first movie in DynamoDB - to prevent the overload of the lambda and of DynamoDB (even if you can specify auto scaling to provision more i/o units to your table). Then, it shift() the array of result (removing the first element and prepare the query to looking for news for the next movie for the next iteration). The BreakingNews Lambda, in parallel, is looking for news for the movie inserted by the PersistMovie Lambda.</p>

<p>As said above, the Result of the parallel state is placed in an array of two element: so the entire return of the PersistMovie state - output of the PersistMovie Lambda - is placed in position 0 (because in the branches the state is defined first): the same for the BreakingNews state - output of the BreakingNews Lambda - that will be placed in the position 1 of the output.</p>

<h5 id="newsiterator">NewsIterator</h5>
<p>The next state is the <code class="highlighter-rouge">NewsIterator</code>: have a look at the variable is looking for. Is exactly the second element of the output array, so the ouput of the BreakingNews-Lambda state, in particular the properties has_elements (this is what I said before about the modification done to the BreakingNews Lambda defined in my previous post).</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">	</span><span class="err">...</span><span class="w">
    </span><span class="s2">"NewsIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Choice"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Choices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"Variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$[1].has_elements"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"BooleanEquals"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ResultPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PrepareSentimentRequest"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ToMovieIterator"</span><span class="w">
    </span><span class="p">},</span></code></pre></figure>

<h5 id="tomovieiterator">ToMovieIterator</h5>
<p>Let’s start from the Default action: if there are no news - has_elements is false, then go to <code class="highlighter-rouge">ToMovieIterator</code></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">	</span><span class="err">...</span><span class="w">
    </span><span class="s2">"ToMovieIterator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:your_region:your_code:function:ToMovieIterator"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MovieIterator"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span></code></pre></figure>

<p>This state simply return the first element of the output array to preserve the structure of the data. In fact, the ToMovieIterator Lambda is a Node.js function with the following code inside.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">	<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="p">};</span></code></pre></figure>

<h5 id="preparesentimentrequest">PrepareSentimentRequest</h5>
<p>If there are News to persist and analysize, then the NewsIterators move to the <code class="highlighter-rouge">PrepareSentimentRequest</code> state.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">    <span class="s2">"PrepareSentimentRequest"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"Type"</span><span class="p">:</span> <span class="s2">"Task"</span><span class="p">,</span>
      <span class="s2">"Resource"</span><span class="p">:</span> <span class="s2">"arn:aws:lambda:your_region:your_code:function:PrepareSentimentRequest"</span><span class="p">,</span>
      <span class="s2">"Next"</span><span class="p">:</span> <span class="s2">"SentimentController"</span>
    <span class="p">},</span>
    <span class="s2">"SentimentController"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"Type"</span><span class="p">:</span> <span class="s2">"Parallel"</span><span class="p">,</span>
      <span class="s2">"Branches"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"StartAt"</span><span class="p">:</span> <span class="s2">"AylienSentiment"</span><span class="p">,</span>
          <span class="s2">"States"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"AylienSentiment"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"Type"</span><span class="p">:</span> <span class="s2">"Task"</span><span class="p">,</span>
              <span class="s2">"InputPath"</span> <span class="p">:</span> <span class="s2">"$[1].aylienQuery"</span><span class="p">,</span>
              <span class="s2">"Resource"</span><span class="p">:</span> <span class="s2">"arn:aws:lambda:your_region:your_code:function:AylienSentiment"</span><span class="p">,</span>
              <span class="s2">"End"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
              <span class="s2">"Retry"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
                  <span class="s2">"ErrorEquals"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"States.ALL"</span> <span class="p">],</span>
                  <span class="s2">"IntervalSeconds"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s2">"MaxAttempts"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="s2">"BackoffRate"</span><span class="p">:</span> <span class="mf">2.0</span>
               <span class="p">}</span> <span class="p">],</span>
              <span class="s2">"Catch"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
                  <span class="s2">"ErrorEquals"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"States.ALL"</span> <span class="p">],</span>
                  <span class="s2">"Next"</span><span class="p">:</span> <span class="s2">"FallBack"</span>
               <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">"FallBack"</span><span class="p">:</span> <span class="p">{</span>
               <span class="s2">"Type"</span><span class="p">:</span> <span class="s2">"Pass"</span><span class="p">,</span>
               <span class="s2">"End"</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">},</span> 
        <span class="p">{</span>
          <span class="s2">"StartAt"</span><span class="p">:</span> <span class="s2">"NoOp"</span><span class="p">,</span>
          <span class="s2">"States"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"NoOp"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"Type"</span><span class="p">:</span> <span class="s2">"Pass"</span><span class="p">,</span>
              <span class="s2">"End"</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">"ResultPath"</span><span class="p">:</span> <span class="s2">"$"</span><span class="p">,</span>
      <span class="s2">"Next"</span><span class="p">:</span> <span class="s2">"PersistNews"</span>
    <span class="p">},</span></code></pre></figure>

<p>This state first call the Lambda <code class="highlighter-rouge">PrepareSentimentRequest</code> that simply prepare the request to be done to the AylienSentiment Lambda - done by the AylienSentimentState. The <code class="highlighter-rouge">PrepareSentimentRequest</code> is Node.js lambda function</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"aylienQuery"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"aylienQuery"</span><span class="p">].</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">description</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"aylienQuery"</span><span class="p">].</span><span class="nx">url</span>  <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">url</span><span class="p">;</span>
    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"aylienQuery"</span><span class="p">].</span><span class="nx">mode</span> <span class="o">=</span> <span class="s2">"document"</span><span class="p">;</span>

    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>

<span class="p">};</span></code></pre></figure>

<h5 id="ayliensentiment-and-error-handling">AylienSentiment and Error Handling</h5>
<p>Thus, the aylienQuery is prepared and the <code class="highlighter-rouge">AylienSentiment</code> can call the respective lambda. But, the input is not a dict, so throught the use of the <code class="highlighter-rouge">InputPath</code> directive, we can specify to <em>manipulate</em> the input by projecting only what we need for the lambda, in this case <code class="highlighter-rouge">$[1].aylienQuery</code>.</p>

<p>The AylienSentiment is the weak part of the chain: I don’t know why, but sometimes the Lambda fails - I think because of the small timeout I use for my APIs and the limitation of the free tier for the service behind the Aylien API. So, I use an error catching flow that retries and eventually goes ahead if things simply doesn’t work for the particular news (covering bad requests due to broken news provided by the News API, for instance).</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="s2">"Retry"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
      <span class="s2">"ErrorEquals"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"States.ALL"</span> <span class="p">],</span>
      <span class="s2">"IntervalSeconds"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">"MaxAttempts"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">"BackoffRate"</span><span class="p">:</span> <span class="mf">2.0</span>
   <span class="p">}</span> <span class="p">],</span>
  <span class="s2">"Catch"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
      <span class="s2">"ErrorEquals"</span><span class="p">:</span> <span class="p">[</span> <span class="s2">"States.ALL"</span> <span class="p">],</span>
      <span class="s2">"Next"</span><span class="p">:</span> <span class="s2">"FallBack"</span>
   <span class="p">}</span> <span class="p">]</span></code></pre></figure>

<p>The fields defined in the Retry properties are self-explained: with the BackoffRate, you can define the multiplier by which the retry interval increases during each attempt (2.0 by default). To learn more about error handling, have a look <a href="https://docs.aws.amazon.com/step-functions/latest/dg/concepts-error-handling.html">here</a>.</p>

<p>I don’t persist the news gathered from the movie in the parallel step - this is done by the No-OP state of type Pass that simply ignore the input and place in output what it receives - because the last state <code class="highlighter-rouge">PersistNews</code>, that calls the respective Lambda function <code class="highlighter-rouge">PersistNews</code>, merges together the sentiment provided by Aylien for the specific news and persist all together.</p>

<h5 id="the-final-persistnews">The final PersistNews</h5>
<p>Have a look at the code below:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'aws-sdk'</span><span class="p">);</span>
<span class="nx">AWS</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="na">region</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGION</span> <span class="p">});</span>
<span class="kd">const</span> <span class="nx">dynamodb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">cleanEmptyField</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'object'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cleanEmptyField</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"PUT begins"</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">sentiment</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">event</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">article</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">articles</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">article</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">'md5'</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">article</span><span class="p">)).</span><span class="nx">digest</span><span class="p">(</span><span class="s2">"hex"</span><span class="p">);</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">article</span><span class="p">,</span> <span class="nx">sentiment</span><span class="p">);</span>
    
    <span class="kd">let</span> <span class="nx">news</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">TableName</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEWS_TABLE</span><span class="p">,</span>
        <span class="na">Item</span><span class="p">:</span> <span class="nx">cleanEmptyField</span><span class="p">(</span><span class="nx">article</span><span class="p">)</span>
    <span class="p">};</span>

    <span class="nx">article</span><span class="p">[</span><span class="s2">"movied_id"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movie_id</span><span class="p">;</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"news: "</span><span class="p">,</span> <span class="nx">article</span><span class="p">);</span>

    <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">news</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> 
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"dynamodb err: "</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"dynamodb data: "</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"PUT end"</span><span class="p">);</span>

    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">articles</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">has_elements</span> <span class="o">=</span> <span class="nx">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">articles</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    
<span class="p">};</span></code></pre></figure>

<p>The Lambda clean the first news to prevent DynamoDB value checking error. Then, it merge together the sentiment provided by Aylien and create a unique identifier using the entire news. In the end, the news is persisted and the array that handles the news is shifted (the first element is removing).</p>

<p>#### Conclusion
The event is then returned as is to the News iterator (already disposed to handle an array because of result).</p>

<h4 id="amazon-cloudwatch-events">Amazon CloudWatch Events</h4>
<p>To have an always updated table of Movies in Theater and News - Sentiment evalued - about them, you can use <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html">Amazon CloudWatch Events</a> and schedule the launch of the workflow, for instance once a week.</p>

<h5 id="improvement">Improvement</h5>
<p>The use of iterator and parallel states to perform persistence and query to other APIs is a good approach to prevent fail of lambda due to timeout errors: in my opinion, AWS Lambda should remain as simple and quick as possible, to perform request and be loaded fast. However, there are some improvement that could be done</p>
<ul>
  <li>Setup the number of news in a parameter from the beginning;</li>
  <li>Clean the flow of iteration and use a parameter to setup the percentage of result to be persisted in each call of Lambda - for instance, 100 Movies, 10% =&gt; 10 Movies persisted each times: this both to reduce the number of steps and to optimize the time of executions;</li>
  <li>Setup better error handling and timeouts for each steps;</li>
</ul>

<p>What will you use step functions for?</p>

<p>Thank you everybody for reading!</p>

<div class="footnotes">
  <ol>
    <li id="fn:catch">
      <p>I will only return on Catch for one of the last state;&nbsp;<a href="#fnref:catch" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


<div class="comments">
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'made2591';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

<hr/>


  
    <div class="post-navs row">
      
        <div class="col-md-6 post-nav">

          <h3 class="section-header">
            Older
            <span class="text-muted"> &middot; </span>
            <a href="/archive">View Archive (35)</a>
          </h3>

          <h2 class="post-title-link"><a href="/posts/quantum-computing">A Quantum Experience</a></h2>
          <h3 id="much-more-than-a-post">Much more than a post</h3>
<p>What is the quantum theory? As said by <a href="https://quantumexperience.ng.bluemix.net/">quantumexperience</a> official site by IBM, it’s <em>an elegant mathematical theory able to explain the counterintuitive behavior of subatomic particles, most notably the phenomenon of entanglement</em>. In the late twentieth century it was discovered that quantum theory applies not only to atoms and molecules, but to bits and logic operations in a computer. This realization has been bringing about a revolution in the science and technology of information processing: I decided to write some notes to better explain, from a physics-agnostic computer scientist’s point of view XD, <strong>what I understood</strong> - and it is certainly wrong - about Q until now and why I think it’s an amazing field for computer science. For skilled guys, <a href="https://github.com/made2591/quantum-notes">here</a> latex source (and <a href="https://made2591.github.io/matteo_madeddu_quantum_notes.pdf">here</a> pdf pre-compiled version) that collect my personal notes about IBM Q platform, in general the quantum-computing world. I was also invited in Verona by the Quantum Research Group of the Department of Computer Science - why? don’t know, maybe the coolest guys were sick 😂 - to talk about the platform and we had a really interesting brain-storming conversation about a quantum version of the Tris game I am working on 😎</p>


        </div>
      
      

        <div class="col-md-6 post-nav">
          <h3 class="section-header">
            Newer
            
          </h3>

          <h2 class="post-title-link"><a href="/posts/free-tier-cloudwatch">AWS Free Tier, Docker and Jenkins: smart resources handling with CloudWatch Events and Slack</a></h2>
          <h3 id="introduction">Introduction</h3>
<p>If you have an <a href="http://aws.amazon.com">AWS account</a> in Free Tier, you have (updated: March, 13th 2018) 750 hours/month to run EC2 (small ones) in your VPC. You also have a lot of other resources, such as AWS Lambda functions (I wrote about them <a href="https://made2591.github.io/posts/aws-lambda">here</a> and <a href="https://made2591.github.io/posts/aws-step-functions">here</a>) and CloudWatch Events. In this article, I talk about smart resources handling and some trick - actually, not so smart XD - I setup to take the best from the services. Attention!!! Picture Spoiler</p>


        </div>
      
    </div>
  



          <div id="footer">
<hr/>
  <div class="pull-left">
    &copy;2019.
    Built with <a href="http://jekyllrb.com/">Jekyll</a> and
    <a href="https://github.com/kirqe/autm-rb">Autm-rb</a>. Thanks to <a href="https://github.com/kirqe">kirqe</a>.
  </div>

  <div class="pull-right">
    <span class="credits pull-right social">
      
        
          <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
        
      
        
          <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
        
      
        
          <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
        
      
        
          <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
        
      
    </span>
  </div>
</div>

        </section>
    </div>
    </div>
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/javascripts/bootstrap.min.js"></script>
    <!-- Place your <script> tags here. -->

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script id="dsq-count-scr" src="//made2591-github-io.disqus.com/count.js" async></script>

<!-- disqus comment counter -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'made2591-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.type = 'text/javascript';
	    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
</script>
<!-- /disqus comment counter -->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111283556-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111283556-1');
</script>
<!-- /google analytics -->

  </body>
</html>
