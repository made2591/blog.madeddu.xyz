<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <!--<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M8WBXH7');</script>-->
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href=/public/stylesheets/bs.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/styles.css?random=@Environment.TickCount>
    <link rel="stylesheet" href=/public/stylesheets/pygment_trac.css?random=@Environment.TickCount>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="canonical" href="made2591.github.io/posts/network-layers-2">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <link rel="icon" type="image/x-icon"  href="/favicon.ico" />
    <title>A journey through the network - Layer 2 | Matteo Madeddu</title>
    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <!--<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8WBXH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrapper">
        <section>
          <div id="header">
  <h1>
    <a id="sitename" href="">Matteo Madeddu</a>
  </h1>

  <!-- Add something about you in p tag-->
  <p>Mac OS lover, Docker fan, Go explorer, Python geek, Trello addicted.</p>
  <hr/>

  <span class="credits pull-left">
    
      <a href="/">Home</a>  | 
    
      <a href="/blog">Blog</a>  | 
    
      <a href="/archive">Archive</a>  | 
    
      <a href="/about">About</a>  | 
    
      <a href="/matteo_madeddu_cv.pdf">Resume</a>  | 
    
      <a href="/quotes">Quotes</a> 
    
  </span>

  <span class="credits pull-right social">
    
      
        <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
      
    
      
        <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
      
    
      
        <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
      
    
      
        <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
      
    
  </span>


</div>


          <div class="post-title">
    <h1>A journey through the network - Layer 2</h1>
    <p class="text-muted">
    


    25 Jan 2018
    
     | <i class="fa fa-comment"></i> <a class="text-muted" href="/posts/network-layers-2/#disqus_thread"></a>
    

    
      | <i class="fa fa-tag"></i>
      
        <a class="text-muted" href="/tags/#theory ">theory</a>,
      
        <a class="text-muted" href="/tags/#network ">network</a>,
      
        <a class="text-muted" href="/tags/#iso/osi ">iso/osi</a>,
      
        <a class="text-muted" href="/tags/#tcp/ip ">tcp/ip</a>,
      
        <a class="text-muted" href="/tags/#saga ">saga</a>
      
    
  </p>
</div>

  <h3 id="a-journey-through-the-network---layer-2">A journey through the network - Layer 2</h3>
<p>A month ago I started to wrote some posts about the network. For those who missed the previous posts, <a href="https://made2591.github.io/posts/network-layers-0">the introduction</a> and <a href="https://made2591.github.io/posts/network-layers-0">the physycal layer</a>. For the previous post I had to go into details about how some parts of the physical layer work but, by going forward with the layers, concepts belonging to separate historical standards - OSI and IP - will intertwine and this entails some troubles from a <em>logical</em> point of view. I will try, as far as possible, to keep only the basic concepts of this layer: I also remember that this layer, together with the physical layer, are - at least in part - joined together in what is called the network access layer in the TCP / IP model.
As a main source I use <a href="https://www.amazon.it/gp/product/9332518742/ref=oh_aui_detailpage_o01_s00?ie=UTF8&amp;psc=1">Computer Networks</a> and <a href="https://www.amazon.it/gp/product/9332535957/ref=oh_aui_detailpage_o02_s00?ie=UTF8&amp;psc=1">TCP/IP Illustrated</a>. In this article, I will talk about layer 1, the data link layer in the ISO / OSI stack. Enjoy the reading!</p>

<p align="center"><img src="https://cdn.ttgtmedia.com/visuals/handbooks/networking/hb_background-networking_3_ehandbook_tablet_horizontal_732X489.jpg" style="width: 100%; marker-top: -10px;" /></p>

<h3 id="introduction">Introduction</h3>
<p>The data link layer uses the services of the physical layer to send and receive bits over communication channels: there are several algorithms for achieving reliable, efficient communication of whole units of frames (or grouped bits - no more individual as in the previous layer) between two adjacent machines. What does it means adjacent? It means that the two machines are connected by a <em>communication channel that acts conceptually like a wire</em>, so that the bits are delivered in exactly the same order in which they are sent. Even if it might be simple, channels make errors, connections pass throught several machines, routers, etc… it’s complicated. Let’s start from the goals.</p>

<h4 id="goals">Goals</h4>
<ul>
  <li>Providing a well-defined service interface to the network layer;</li>
  <li>Dealing with transmission errors;</li>
  <li>Regulating the flow of data so that slow receivers can comunicate with fast senders;</li>
</ul>

<p>To guarantee this functionalities, the data link layer takes the packets it gets from the network layer and encapsulates them into frames for transmission: each frame is composed by a frame header, a payload field for holding the packet, and a frame trailer. It’s really important to examine the principles of error control and flow control used in data link layer because they are used also by upper layers.</p>

<h4 id="offered-services">Offered services</h4>
<p>The data link layer can be designed to offer various services. Following the Computer Networks book by A. Tanembaum:</p>

<table>
  <thead>
    <tr>
      <th>Service</th>
      <th>Description</th>
      <th>Use</th>
      <th>Example(s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Unacknowledged connectionless service</td>
      <td>Consists of having the source machine send independent frames to the destination machine without having the destination machine acknowledge them. If errors happen, there are no attempt to detect and recover them</td>
      <td>Appropriate when the error rate is very low, so recovery is left to higher layers, like real time traffic, voice</td>
      <td>Ethernet</td>
    </tr>
    <tr>
      <td>Acknowledged connectionless service</td>
      <td>There are still no logical connections used, but each frame sent is individually acknowledged. If it has not arrived within a specified time interval, it can be sent again</td>
      <td>This service is useful over unreliable channels, such as wireless systems</td>
      <td>802.11 (WiFi)</td>
    </tr>
    <tr>
      <td>Acknowledged connection-oriented service</td>
      <td>With this service, the source and destination machines establish a connection before any data are transferred</td>
      <td>Each frame sent over the connection is numbered, and the data link layer guarantees that each frame is sent exactly once, indeed received, in the right order</td>
      <td>Satellite Channel, Long-Distance Telephone Circuit</td>
    </tr>
  </tbody>
</table>

<p>When connection-oriented service is used, transfers go through three distinct phases. In the first phase, the connection is established by having both sides initialize variables and counters needed to keep track of which frames have been received and which ones have not. In the second phase, one or more frames are actually transmitted. In the third and final phase, the connection is released, freeing up the variables, buffers, and other resources used to maintain the connection.</p>

<h4 id="framing">Framing</h4>
<p>Physical layer provide some sort of redundancy / correction error codes to transport bits over the channel: but data are not guaranteed to be sent over super noisy channels, so data link layer divides the stream of bits in frame, and add to each of them a checksum - with predefined algorithm. When a frame arrives at the destination, the checksum is recomputed: if it wrong, it can handle the error, normally sending back an error. Let’s have a look at framing algorithms.</p>

<h5 id="algorithms">Algorithms</h5>
<ul>
  <li>Byte count: not used anymore, consists of of set the number of byte in a field inside the header. The problem is that even the count can be garbled by an errors, and even if the destination thanks to the checksum knows that the frame is broken, it can’t locate the correct start of the next frame.</li>
  <li>Flag bytes with <strong>byte stuffing</strong>: resynchronization is resolved using a flag byte that wraps a frame (both at the beginning and the ending). But what if the flag byte occurs in the data? One solution consists in escaping the flag byte with a an escape byte. What if the escape byte occurs? The escape byte is escaped. This scheme is a slight simplification of the one used in PPP (Point-to-Point Protocol).</li>
  <li>Flag bits with bit stuffing: framing can be also be done at the bit level. In the <strong>HDLC</strong> (High-level Data Link Control) protocol each frame begins and ends with a special bit pattern, 01111110 or 0x7E in hexadecimal. This pattern is a flag byte. Whenever the sender’s data link layer encounters five consecutive 1s in the data, it automatically stuffs a 0 bit into the outgoing bit stream. USB use this method, known as <strong>bit stuffing</strong>. When the receiver sees five consecutive incoming 1 bits, followed by a 0 bit, it automatically destuffs.</li>
  <li>Physical layer coding violations: this method consists in use redundancy signal (reversed) in physical layer to transport (indicate) the start and end of frames. It’s a code violation to delimit frames.</li>
</ul>

<p>A common pattern is to use a mix of these methods: for instance, Ethernet and 802.11 use a frame beginning with a well-defined pattern called a <strong>preamble</strong>. This pattern might be quite long (72 bits is typical for 802.11) to allow the receiver to prepare for an incoming packet. The preamble is then followed by a length (i.e., count) field in the header that is used to locate the end of the frame.</p>

<h4 id="about-errors">About errors</h4>
<p>There are two basic strategies for dealing with errorsb: both of them add redundant information to the data that is sent.</p>
<ul>
  <li>first strategy (using <strong>error-correcting codes</strong> or <strong>FEC</strong> - Forward Error Correction): include enough redundant information to enable the receiver to deduce what the transmitted data must have been.</li>
  <li>second strategy (using <strong>error-detecting codes</strong>): include enough redundant information to enable the receiver to deduce that an error has occurred.</li>
</ul>

<p>Of course the best way to handle error on channel like fiber is to retransmit (they are faster). FEC is used on noisy channels because retransmissions are just as likely to be in error as the first transmission.</p>

<h5 id="error-correcting-codes">Error-Correcting Codes</h5>
<p>These are the most famous error-correcting codes</p>
<ul>
  <li>Hamming codes</li>
  <li>Binary convolutional codes</li>
  <li>Reed-Solomon codes</li>
  <li>Low-Density Parity Check codes</li>
</ul>

<p>Before going on with details of each methods, let define a frame:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A frame consists of m data (i.e., message) bits and r redundant (i.e. check) bits.
</code></pre></div></div>

<p>There are several ways to compute r codes:
<strong>block code</strong>: the r check bits are computed solely as a function of the m data bits with which they are associated, as though the m bits were looked up in a large table to find their corresponding r check bits.
<strong>systematic code</strong>: the m data bits are sent directly, along with the check bits, rather than being encoded themselves be- fore they are sent. 
<strong>linear code</strong>: the r check bits are computed as a linear function - XOR or modulo 2 addition is a popular choice - of the m data bits.</p>

<p>Let the total length of a block be <script type="math/tex">n</script> (i.e., <script type="math/tex">n = m + r</script>) - the <script type="math/tex">(n, m)</script> code. An <script type="math/tex">n</script>-bit unit containing data and check bits is referred to as an <script type="math/tex">n</script>-bit codeword. The <strong>code rate</strong>, or simply rate, is the fraction of the codeword that carries information that is not redundant, or <script type="math/tex">m/n</script>. The rates used in practice vary widely. They might be 1/2 for a noisy channel, in which case half of the received information is redundant, or close to 1 for a high-quality channel, with only a small number of check bits added to a large message. Ok, but why codewords?</p>

<p>The number of bit positions in which two codewords differ is called the Hamming distance, and it is computed using the XOR of the two codewords and count the number of 1 bits in the result. Its significance is that if two codewords are a Hamming distance <script type="math/tex">d</script> apart, it will require d single-bit errors to convert one into the other. Example: you need to design a code with <script type="math/tex">m</script> message bits and <script type="math/tex">r</script> check bits that will allow all single errors to be corrected. Each of the <script type="math/tex">2^m</script> legal messages has <script type="math/tex">n</script> illegal codewords at a distance of $1$ from it: each of them is formed by inverting each of the <script type="math/tex">n</script> bits in the <script type="math/tex">n</script>-bit codeword formed from it. Each of the <script type="math/tex">2^m</script> legal messages requires <script type="math/tex">n + 1</script> bit patterns dedicated to it. Since the total number of bit patterns is <script type="math/tex">2^n</script>, we must have <script type="math/tex">(n + 1) 2^m \leq 2^n</script>. Using <script type="math/tex">n = m + r</script>, this requirement becomes <script type="math/tex">(m + r + 1) \leq 2^r</script>. Given <script type="math/tex">m</script>, this puts a lower limit on the number of check bits needed to correct single errors.</p>

<p><span style="color:#A04279; font-size: bold;"><strong>Hamming codes</strong></span> the bits of the codeword are numbered consecutively, starting with bit 1 at the left end, bit 2 to its immediate right, and so on. The bits that are powers of 2 (1, 2, 4, 8, 16, etc.) are check bits. The rest (3, 5, 6, 7, 9, etc.) are filled up with the m data bits. A bit is checked by just those check bits occurring in its expansion (e.g., bit 11 is checked by bits 1, 2, and 8). For more details over the other codes, look at chapter 4 of Tanembaum’s book.</p>

<h5 id="error-detecting-codes">Error-Detecting Codes</h5>
<p>There are three types of error-detecting codes:</p>
<ul>
  <li>parity codes</li>
  <li>checksums codes</li>
  <li>cyclic redundancy checks (CRCs), also known as a polynomial code, are based upon treating bit strings as representations of polynomials with coefficients of 0 and 1 only.</li>
</ul>

<h4 id="about-flow-controls">About flow controls</h4>
<p>When a node is transmitting to another node, even if the transmission is error free, the receiver may be unable to handle the frames as fast as they arrive and will lose some. To prevent this situation, two approaches are commonly used:</p>
<ul>
  <li><strong>Feedback-based flow control</strong>: the receiver sends back information to the sender giving it permission to send more data, or at least telling the sender how the receiver is doing.</li>
  <li><strong>Rate-based flow control</strong>: the protocol has a built-in mechanism that limits the rate at which senders may transmit data, without using feedback from the receiver. This scheme is part of the transport layer.</li>
</ul>

<h3 id="conclusion">Conclusion</h3>
<p>I don’t want to go in details on sliding windows and MAC Protocol, because they are at really low levels: in the next chapter I will talk more about the network layer, concerned to get packets from the source all the way to the destination. Getting to the destination may require making many hops at intermediate routers along the way. This function clearly contrasts with that of the data link layer, which has the more modest goal of just moving frames from one end of a wire to the other. Thus, the network layer is the lowest layer that deals with end-to-end transmission: further, when the source and destination are in different networks, new problems occur. It is up to the network layer to deal with them. In next post I will talk about this layer primarily using the TCP/IP book so focusing mainly on the Internet standard and <em>its</em> network layer protocol, IP.</p>


<div class="comments">
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'made2591';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

<hr/>


  
    <div class="post-navs row">
      
        <div class="col-md-6 post-nav">

          <h3 class="section-header">
            Older
            <span class="text-muted"> &middot; </span>
            <a href="/archive">View Archive (35)</a>
          </h3>

          <h2 class="post-title-link"><a href="/posts/go-py-benchmark">GoLang vs Python: deep dive into the concurrency</a></h2>
          <h3 id="introduction">Introduction</h3>
<p>In the last months, I worked a lot with GoLang on several projects. Although I’m certainly not an expert, there are several things that I really appreciate about this language: first, it has a clear and simple syntax, and more than once I noticed that the style of the Github developers is very close to the style used in old C programs. From a theoretical point of view, GoLang seems to take the best of all worlds: there is the power of high-level languages, made simple by clear rules - even if sometime they are a little bit binding - that can impose a solid logic to the code. There is the simplicity of the imperative style, made of primitive types with the size in bits in their name, but without the boredom of manipulating strings as array of characters. However, two really useful and interesting features in my opinion are the goroutine and the channels.</p>


        </div>
      
      

        <div class="col-md-6 post-nav">
          <h3 class="section-header">
            Newer
            
          </h3>

          <h2 class="post-title-link"><a href="/posts/aws-lambda">AWS Lambda, GoLang and Grafana to perform sentiment analysis for your company / business</a></h2>
          <h3 id="introduction">Introduction</h3>
<p>In this article I will talk about my experience with AWS Lambda + API Gateway, GoLang (of course) and Grafana to build a sentiment analysis tool over customizable topics. Who should you read this post? Don’t know, maybe a CIO, a CTO, a CEO, a generic Chief or a MasterChef, for sure an AWS and GoLang fan like me. First of all: to better understand how to use Elasticsearch, read my previous post <a href="https://made2591.github.io/posts/elasticnas">Elasticsearch over My home Network Attached Storage</a>: it’s not so exciting as it seems, but you will have a general idea about what is Elasticsearch and how can you use it. Second: if you don’t know about AWS Lambda, study it. I personally believe that it represents one of the most interesting services currently offered by AWS: as they state, <em>AWS Lambda lets you run code without provisioning or managing servers</em>. You pay only for the compute time you consume and there is no charge when your code is not running. The amazing thing is that with a Free Tier trial you have 1 milions requests for free - O.O - to run code of any type of application or backend service - all with zero administration: you just upload your code - unfortunately the online editor for GoLang is not supported yet - and AWS Lambda<sup id="fnref:lambda"><a href="#fn:lambda" class="footnote">1</a></sup> takes care of everything required to run and scale your code with high availability. You can even set up your code to automatically trigger from other AWS services - as I have done with API Gateway - or call it directly from any web or mobile app. And…last but definetly not the least, why I’m writing this post!? Because starting from <a href="https://aws.amazon.com/it/blogs/compute/announcing-go-support-for-aws-lambda/">15 January 2018</a>, AWS Lambda support GoLang!!!</p>

<div class="footnotes">
  <ol>
    <li id="fn:lambda">
      <p>You can find more information <a href="https://aws.amazon.com/lambda/?nc1=h_ls">here</a>&nbsp;<a href="#fnref:lambda" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

        </div>
      
    </div>
  



          <div id="footer">
<hr/>
  <div class="pull-left">
    &copy;2019.
    Built with <a href="http://jekyllrb.com/">Jekyll</a> and
    <a href="https://github.com/kirqe/autm-rb">Autm-rb</a>. Thanks to <a href="https://github.com/kirqe">kirqe</a>.
  </div>

  <div class="pull-right">
    <span class="credits pull-right social">
      
        
          <a href="https://github.com/made2591/" target="_blank"><i class="fa fa-github"></i></a>
        
      
        
          <a href="https://twitter.com/made2591" target="_blank"><i class="fa fa-twitter"></i></a>
        
      
        
          <a href="https://linkedin.com/in/mmadeddu" target="_blank"><i class="fa fa-linkedin"></i></a>
        
      
        
          <a href="https://www.facebook.com/matteo.madeddu" target="_blank"><i class="fa fa-facebook"></i></a>
        
      
    </span>
  </div>
</div>

        </section>
    </div>
    </div>
    <script src="/public/javascripts/jquery.min.js"></script>
    <script src="/public/javascripts/bootstrap.min.js"></script>
    <!-- Place your <script> tags here. -->

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script id="dsq-count-scr" src="//made2591-github-io.disqus.com/count.js" async></script>

<!-- disqus comment counter -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'made2591-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function () {
	    var s = document.createElement('script'); s.async = true;
	    s.type = 'text/javascript';
	    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
	    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
	}());
</script>
<!-- /disqus comment counter -->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111283556-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111283556-1');
</script>
<!-- /google analytics -->

  </body>
</html>
